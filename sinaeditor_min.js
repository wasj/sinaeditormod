if(!window.SinaEditor){SinaEditor={}}if(!SinaEditor.CONF){SinaEditor.CONF={}}SinaEditor.CONF.redoConf=100;SinaEditor.CONF.bubbleStyles=['.se_bubble {','background-color:#E0ECFF;','font-family:Arial,sans-serif,sans;','font-size:13px;','position:absolute;','border:1px solid #99C0FF;','padding:3px;','z-index:1000;','-moz-border-radius: 5px;','-khtml-border-radius: 5px;','-webkit-border-radius: 5px;','border-radius: 5px;','}'].join('');SinaEditor.CONF.bubbleClassName='se_bubble';var href=window.location.href;var loc=href.substring(0,href.lastIndexOf('/'));SinaEditor.CONF.STYLELOC=loc+'/style/';SinaEditor.CONF.transparentIMG=SinaEditor.CONF.STYLELOC+"imgs/SG_line.gif";SinaEditor.CONF.fakeFLASH=SinaEditor.CONF.STYLELOC+"imgs/fake_flash.png";SinaEditor.CONF.aBubbleTemplete=['<div class="se_bubble_a_panel">','<div>','<div>','<span>Go to link:</span>','<span style="color: black;">','<a class="se_bubble_a_link" href="#{src}" target="_blank">','#{srcstr}','</a>','</span>','<span>','&nbsp;&nbsp;','<span class="se_bubble_a_link" id="#{modifyid}">Change</span>','</span>','<span>','&nbsp;&nbsp;','<span class="se_bubble_a_link" id="#{deleteid}">Remove</span>','</span>','</div>','</div>','</div>'].join('');SinaEditor.CONF.mailBubbleTemplete=['<div class="se_bubble_a_panel">','<div>','<div>','<span id="tr_link-text" style="color: black;">','#{srcstr}','</span>','<span>','&nbsp;&nbsp;','<span class="se_bubble_a_link" id="#{modifyid}">Change</span>','</span>','<span>','&nbsp;&nbsp;','<span class="se_bubble_a_link" id="#{deleteid}">Remove</span>','</span>','</div>','</div>','</div>'].join('');SinaEditor.CONF.imgBubbleTemplete=['<div class="se_bubble_a_panel">','<div>','<div>','<span>','<span class="se_bubble_a_link" id="#{modifyid}">Change Image</span>','</span>','<span>','&nbsp;&nbsp;','<span class="se_bubble_a_link" id="#{deleteid}">Delete Image</span>','</span>','</div>','</div>','</div>'].join('');SinaEditor.CONF.flashBubbleTemplete=['<div class="se_bubble_a_panel">','<div>','<div style="float:left;">','<span>','<span class="se_bubble_a_link" id="#{seeid}">Preview Movie -&nbsp;</span>','</span>','<span>','<span class="se_bubble_a_link" id="#{deleteid}">Delete Movie</span>','</span>','<div style="border:1px solid;display:none;" id="#{showflash}"></div>','</div>','<img id="#{closeid}" src="',SinaEditor.CONF.STYLELOC,'imgs/bubble_closebox.gif" style="padding:3px;float:left;">','</div>','</div>'].join('');SinaEditor.CONF.aBubbleStyles=['.se_bubble_a_panel{','}','.se_bubble_a_link{','color:#0000CC;','cursor:pointer;','font-size:100%;','}'].join('');if(!SinaEditor.STATE){SinaEditor.STATE={}}SinaEditor.STATE.CREATING=1;SinaEditor.STATE.CREATED=2;SinaEditor.STATE.EDITING=3;SinaEditor.STATE.SHOWSOURCE=4;if(!SinaEditor.NODETYPE){SinaEditor.NODETYPE={}}SinaEditor.NODETYPE.ELEMENT=1;SinaEditor.NODETYPE.TEXT=3;SinaEditor.NODETYPE.HTMLELEMENT=9;if(!SinaEditor.MOUSEKEY){SinaEditor.MOUSEKEY={}}SinaEditor.MOUSEKEY.LEFT=1;SinaEditor.MOUSEKEY.MID=2;SinaEditor.MOUSEKEY.RIGHT=3;if(!SinaEditor.BUTTONSTATE){SinaEditor.BUTTONSTATE={}}SinaEditor.BUTTONSTATE.NORMAL=1;SinaEditor.BUTTONSTATE.DISABLED=2;SinaEditor.BUTTONSTATE.CLICKED=3;if(!SinaEditor.BUTTON){SinaEditor.BUTTON={}}SinaEditor.BUTTON['default']=function(btn){switch(this.getState()){case SinaEditor.STATE.CREATING:btn.setState(SinaEditor.BUTTONSTATE.DISABLED);break;case SinaEditor.STATE.EDITING:btn.setState(SinaEditor.BUTTONSTATE.NORMAL);break;case SinaEditor.STATE.SHOWSOURCE:btn.setState(SinaEditor.BUTTONSTATE.DISABLED);break;default:btn.setState(SinaEditor.BUTTONSTATE.DISABLED)}};if(!SinaEditor.RANGE){SinaEditor.RANGE={}}SinaEditor.RANGE.BLOCKTAGS={"DIV":"1","P":"1","TD":"1","LI":"1","OL":"1","NOBR":"1","BODY":"1"};SinaEditor.RANGE.STYLEOBJECTELEMENTS={"IMG":1,"HR":1,"LI":1,"TABLE":1,"TR":1,"TD":1,"TH":1,"EMBED":1,"OBJECT":1,"OL":1,"UL":1,"A":1,"INPUT":1,"FORM":1,"SELECT":1,"TEXTAREA":1,"BUTTON":1,"FIELDSET":1,"THREAD":1,"TFOOT":1};SinaEditor.RANGE.SKIPTAGS={"IMG":"1","BR":"1","TABLE":"1","CAPTION":"1","COL":"1","COLGROUP":"1","TBODY":"1","TFOOT":"1","TH":"1","THREAD":"1","TR":"1","UL":"1"};SinaEditor.RANGE.blockBoundaryDisplayMatch={'block':1,'list-item':1,'table':1,'table-row-group':1,'table-header-group':1,'table-footer-group':1,'table-row':1,'table-column-group':1,'table-column':1,'table-cell':1,'table-caption':1};if(!SinaEditor.TOOLCONF){SinaEditor.TOOLCONF={}}SinaEditor.TOOLCONF.COLOR={'000000':'Black','800000':'Maroons','8B4513':'Sepia','2F4F4F':'Dark green','008080':'Turquoise','000080':'Navy','4B0082':'Indigo','696969':'Dark gray','B22222':'Brick red','A52A2A':'Brown','DAA520':'Golden','006400':'Dark green','40E0D0':'Blue-green','0000CD':'Medium blue','800080':'Purple','808080':'Gray','F00':'Red','FF8C00':'Deep orange','FFD700':'Gold','008000':'Green','0FF':'Green','00F':'Blue','EE82EE':'Violet','A9A9A9':'Dark gray','FFA07A':'Bright orange','FFA500':'Orange','FFFF00':'Yellow','00FF00':'Aqua','AFEEEE':'Blue','ADD8E6':'Brilliant Blue','DDA0DD':'Plum','D3D3D3':'Light gray','FFF0F5':'Purple red','FAEBD7':'Antique white','FFFFE0':'Yellow','F0FFF0':'Honey White','F0FFFF':'Azure','F0F8FF':'Light blue','E6E6FA':'Purple','FFF':'White'};SinaEditor.TOOLCONF.FONTFAMILYDEF='Font';SinaEditor.TOOLCONF.FONTFAMILYCONF=[{'html':'SimSun'},{'html':'SimHei'},{'html':'SimLi'},{'html':'SimKai','style':'SimKai,STKaiti'},{'html':'SimYou'},{'html':'Arial'},{'html':'Impact'},{'html':'Georgia'},{'html':'Verdana'},{'html':'Courier New'},{'html':'Times New Roman'}];SinaEditor.TOOLCONF.FONTSIZEDEF='Size';SinaEditor.TOOLCONF.FONTSIZECONF=[{'html':'10px'},{'html':'12px'},{'html':'14px'},{'html':'16px'},{'html':'18px'},{'html':'20px'},{'html':'22px'},{'html':'24px'},{'html':'32px'},{'html':'56px'}];SinaEditor.TOOLCONF.linkTemplate=['<div class="linkItemContent">','<div class="row1" id="#{hidden}" style="display:none">Text:','<input class="fm1" id="#{text}">','</div>','<div class="row2">Link:','<input value="http://" class="fm1" id="#{link}">','</div>','<div class="row3">','<a onclick="return false" id="#{ok}" href="#" class="SG_aBtn SG_aBtnB"><cite>OK</cite></a>','<a onclick="return false" id="#{cancel}" href="#" class="SG_aBtn SG_aBtnB"><cite>Cancel</cite></a>','</div>','</div>'].join('');SinaEditor.TOOLCONF.addLinkNow=/.*(http|ftp|https|mailto)\:\/\/.*/i;SinaEditor.TOOLCONF.imgType=/.*\.(gif|bmp|png|jpg)$/i;SinaEditor.TOOLCONF.imgErrTypeMSG='Only gif, bmp, png, jpg images can be uploaded';SinaEditor.TOOLCONF.imgTemplate=['<div class="insetPhotoContent insetPhotoContent_l">','<div id="headerTab" class="headerTab">','<h4>Insert image from:</h4>','<ul><li class="cur" id="#{tabMy}"><a href="#" onclick="return false;">Local computer</a></li><li id="#{tabWeb}" class=""><a href="#" onclick="return false;">the web</a></li></ul></div>','<div style="display:none" id="#{errTips}" class="errTips"></div>','<!-- Error info -->','<div id="#{useClient}" class="urlPath">','<div id="#{clientView}">','<span>Choose an local image:</span>','<div id="#{clientUploadDiv}" class="clientUploadDiv" >','<form target="#{clientIframe}" id="#{clientForm}" action="postImg.php" method="POST" enctype="multipart/form-data">','<input type="file" name="imgFile" class="imgFile" id="#{clientFile}">','<textarea name="imgValue" style="display:none" id="#{clientFileDrag}"></textarea>','</form>','<div>Click here to choose an file. Please config a server-side script or upload may fail. <span id="#{clientMoreUp}" style="display:none;">You can also upload by drag and drop</span></div>','</div>','<iframe id="#{clientIframe}" name="#{clientIframe}" style="display:none" ></iframe>','</div>','<div id="#{contentLoading}" style="display:none">','<div class="loading"></div>','<a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="#" onclick="return false;">','<cite id="#{cancleClient}">Cancel upload</cite>','</a>','</div>','<div id="#{clientResult}" style="display:none">','<div class="clientImg">','<img id="#{resultPic}">','</div>','<a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="#" onclick="return false;">','<cite id="#{addClientPic}">Add</cite>','</a>','<a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="#" onclick="return false;">','<cite id="#{resetClient}">Re-upload</cite>','</a>','</div>','</div>','<div style="display: none;" id="#{webContent}" class="urlPath">','<div>','<span>Type in an URL to the image:</span>','<input type="text" class="fmTxt" value="http://" id="#{webUrl}" maxlength="400">','<a id="#{webAdd}" style="display:none;" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;">','<cite>Add</cite>','</a>','</div>','<div class="webImg" style="display:none;">','<img id="#{webPic}">','</div>','<div id="#{webPicLoading}" class="webImgLoad" style="display:none;"></div>','</div>','</div>'].join('');SinaEditor.TOOLCONF.flashTemplate=['<div class="linkItemContent">','<div class="row1">HTML Code:','<input class="fm1" style="width:100%;margin-top:3px" id="#{flashSrc}">','</div>','<div class="row1">','<span style="color:red;display:none" id="#{flashErrTip}">* Please insert code snippets of a flash movie</span>','</div>','<div class="row3">','<a onclick="return false" href="#" class="SG_aBtn SG_aBtnB"><cite id="#{ok}">OK</cite></a>','<a onclick="return false" href="#" class="SG_aBtn SG_aBtnB"><cite id="#{cancel}">Cancel</cite></a>','</div>','</div>'].join('');SinaEditor.TOOLCONF.tableTemplate=['<div id="#{panel}" class="se_tab_tableContent">','<div id="#{eventContent}" class="se_tab_eventContent">','<div style="width: 100%; height: 100%;">','<div class="se_tab_mainContent"></div>','<div id="#{baseContent}" class="se_tab_baseContent"></div>','<div id="#{chooseContent}" class="se_tab_chooseContent"></div>','</div>','</div>','<div class="num" id="#{tabNums}"> 0 x 0 </div>','</div>'].join('');SinaEditor.TOOLCONF.faceTemplate='<div class="se_face_bubble" id="#{panel}"></div>';SinaEditor.TOOLCONF.faceSrc=[{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7400ZH00SIGG.gif','title':'Left humming'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7401ZH00SIGG.gif','title':'Right humming'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7402ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7403ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7404ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7405ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7406ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7407ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7408ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7409ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7410ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7411ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7412ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7413ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7414ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7415ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7416ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7417ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7418ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7419ZH00SIGG.gif'},{'src':'http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___7420ZH00SIGG.gif'}];SinaEditor.TOOLCONF.historyMax=5;SinaEditor.TOOLCONF.historyTemplate='<div class="se_history_bubble" id="#{panel}"></div>';if(!window.console){console={};console.log=function(){}}if(!window.SinaEditor){SinaEditor={}}if(!SinaEditor.env){SinaEditor.env={}}(function(ns){var _ua=navigator.userAgent.toLowerCase();ns.$IE=/msie/.test(_ua);ns.$OPERA=/opera/.test(_ua);ns.$GENKO=/gecko\//.test(_ua);ns.$WEBKIT=/applewebkit/.test(_ua);ns.$IE5=/msie 5 /.test(_ua);ns.$IE6=/msie 6/.test(_ua);ns.$IE7=/msie 7/.test(_ua);ns.$IE8=/msie 8/.test(_ua);ns.$winXP=/windows nt 5.1/.test(_ua);ns.$winVista=/windows nt 6.0/.test(_ua);ns.$FF=/firefox/i.test(_ua);ns.$CHROME=/chrome/i.test(_ua);ns.$SAFARI=/safari/.test(_ua)&&!ns.$CHROME;ns.$TT=/tencenttraveler/.test(_ua);ns.$360=/360se/.test(_ua);ns.$Maxthon=false;try{var t=window.external;ns.$Maxthon=t.max_version?true:false}catch(e){}ns.isCustomDomain=(function(){var domain=document.domain,hostname=window.location.hostname;return this.ie&&domain!==hostname&&domain!==('['+hostname+']')}())}(SinaEditor.env));if(!window.SinaEditor){SinaEditor={}}SinaEditor.ev={};(function(ns){var _customEventList={};ns.customEvent={};var _domReferObj={};var _eventsFunc={};var _proxyFuncs={};var _getProxyFunc=function(uid,content,opt_args){var funcs=_eventsFunc[uid];return function(e,args){var funcArr=funcs[e.type]||[];var i=0;args=args||opt_args;args.unshift(ns.fixEvent(e));for(i=0;funcArr[i];i++){funcArr[i].func.apply(content,args)}args.pop()}};var _clearEvent=function(elm,type,fHandler,opt){if(_customEventList[type]){return}if(elm.removeEventListener){elm.removeEventListener(type,fHandler,false)}else if(elm.detachEvent){elm.detachEvent('on'+type,fHandler,false)}else{elm['on'+type]=null}};var _getUidByDom=function(elm){var uid=null;for(uid in _domReferObj){if(_domReferObj[uid]===elm){return uid}}return null};ns.fixEvent=function(e){if(!e.target){try{e.target=e.srcElement;if(e.button){switch(e.button){case 1:e.which=SinaEditor.MOUSEKEY.LEFT;break;case 4:e.which=SinaEditor.MOUSEKEY.MID;break;case 2:e.which=SinaEditor.MOUSEKEY.RIGHT;break}}}catch(e){}e.pageX=e.x;e.pageY=e.y}if(typeof e.layerX==='undefined'){e.layerX=e.offsetX}if(typeof e.layerY==='undefined'){e.layerY=e.offsetY}return e};ns.stopEvent=function(ev){ev.cancelBubble=true;ev.returnValue=false};if(!SinaEditor.env.$IE){ns.stopEvent=function(ev){ev.preventDefault();ev.stopPropagation()}}ns.add=function(elm,type,func,opt){opt=opt||{};opt.content=opt.content||elm;var uid=_getUidByDom(elm);if(!uid){uid=SinaEditor.util.uniqueKey();_domReferObj[uid]=elm;_eventsFunc[uid]={}}var funcObj=_eventsFunc[uid];if(!funcObj[type]){funcObj[type]=[];opt.args=opt.args||[];if(Object.prototype.toString.apply(opt.args)!=='[object Array]'){throw new Exception('opt.args must be an array')}_proxyFuncs[uid]=_getProxyFunc(uid,opt.content,opt.args);if(!_customEventList[type]){if(elm.addEventListener){elm.addEventListener(type,_proxyFuncs[uid],false)}else if(elm.attachEvent){elm.attachEvent('on'+type,_proxyFuncs[uid],false)}else{elm['on'+type]=_proxyFuncs[uid]}}}if(funcObj[type].length&&opt.once){return-1}var eventId=SinaEditor.util.uniqueKey();funcObj[type].push({'func':func,'id':eventId});return eventId};ns.remove=function(elm,type,fHandler,opt){var uid=_getUidByDom(elm);if(!uid){return}var funcObj=_eventsFunc[uid];if(!fHandler){delete funcObj[type];_clearEvent(elm,type,fHandler,opt);return}var events=funcObj[type];if(events){var val=typeof fHandler==='function'?'func':'id';var i;for(i=0;events[i];i++){if(events[i][val]===fHandler){funcObj[type].splice(i,1);break}}if(SinaEditor.util.isEmptyObject(funcObj[type])){delete funcObj[type];_clearEvent(elm,type,fHandler,opt)}}};ns.fire=function(elm,type,opt){if(_customEventList[type]){opt=opt||{};var uid=_getUidByDom(elm);if(uid){_proxyFuncs[uid]({'type':type},opt.args)}}else{if(elm.fireEvent){elm.fireEvent('on'+type)}else{var evt=elm.ownerDocument.createEvent('HTMLEvents');evt.initEvent(type,true,true);elm.dispatchEvent(evt)}}};ns.$regEvent=function(eventName,editor){var whenTigger,eObj,events,i,ev;if(ns.customEvent[eventName]){if(!_customEventList[eventName]){_customEventList[eventName]={}}if(!_customEventList[eventName][editor.option.id]){_customEventList[eventName][editor.option.id]=[]}var uid=SinaEditor.util.uniqueKey()}else{return}whenTigger=ns.customEvent[eventName](editor);if(!whenTigger){return}for(i=0;whenTigger[i];i++){eObj=whenTigger[i];events=eObj.events;for(ev in events){if(events.hasOwnProperty(ev)){ns.add(eObj.enty,ev,events[ev])}}}}}(SinaEditor.ev));if(!window.SinaEditor){SinaEditor={}}(function(){function object(o){function F(){}F.prototype=o;return new F()}Function.prototype.$define=function(def){var k;for(k in def){if(def.hasOwnProperty(k)){this.prototype[k]=def[k]}}if(this.__interface__){for(k in this.prototype){if(this.prototype[k]==="NI"){throw new Error("Class def error, protocol method ["+k+"] not implemented")}}}this.prototype.constructor=this;this.$extends=this.$define=this.$implements=function(){throw new Error("there should be no other definition after $define clause")};return this};Function.prototype.$extends=function(){var me=this,i=arguments.length,sup,fn;if(i===0){throw new Error("$extends syntax error: parent class not specified")}sup=arguments[0];fn=function(){sup.apply(this,arguments);me.apply(this,arguments)};fn.prototype=object(sup.prototype);fn.prototype.constructor=fn;fn.$super=sup.prototype;return fn};Function.prototype.$implements=function(){var arg=Array.prototype.slice.call(arguments,0),fn,i=arg.length,k;while(i--){if(typeof arg[i]!=="object"){throw new Error("$implements syntax error: paramenters should be of object type")}for(k in arg[i]){if(typeof this.prototype[k]==="undefined"){this.prototype[k]="NI"}}}this.__interface__=true;this.$extends=function(){throw new Error("$extends syntax error: $extends clause should be before the definition of $implements")};return this}})();if(!window.SinaEditor){SinaEditor={}}SinaEditor.pkg=function(ns,callBack){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=SinaEditor;var i;for(i=(levels[0]=='SinaEditor')?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}if(callBack){callBack(nsobj)}return nsobj};SinaEditor.pkg('SinaEditor.operation');if(!SinaEditor.util){SinaEditor.util={}}SinaEditor.pkg('SinaEditor.util',function(ns){ns.isEmptyObject=function(obj){var name;for(name in obj){return false}return true};ns.uniqueKey=function(){var dt=(+new Date())+'';var len=dt.length;return parseInt(Math.random()*10000,10)+''+dt.substring(len/2,len-1)};ns.trim=function(str){str=str.replace(/^\s\s*/,'');var ws=/\s/;var i=str.length;while(ws.test(str.charAt(--i))){}return str.slice(0,i+1)};ns.o2s=function(o){var strs=[];var me=arguments.callee;var type=Object.prototype.toString.call(o);switch(type){case'[object Array]':var i;strs.push('[');for(i=0,len=o.length;i<len;i++){strs.push(me(o[i]));strs.push(',')}if(strs[1]){strs.pop()}strs.push(']');return strs.join('');case'[object Object]':var key;strs.push('{');for(key in o){strs.push(me(key));strs.push(':');strs.push(me(o[key]));strs.push(',')}if(strs[1]){strs.pop()}strs.push('}');return strs.join('');case'[object String]':strs.push('"');strs.push(o.replace(/\\/g,'\\\\').replace(/'/g,'\\\'').replace(/"/g,'\\"'));strs.push('"');return strs.join('');case'[object Number]':case'[object Boolean]':return o;default:return o.toString?o.toString():'[unsupported]'}};ns.mix=function(target,ref){if(ref){var key;for(key in ref){target[key]=ref[key]}}return target};ns.s2o=function(str){try{return eval('('+str+')')}catch(e){return null}}});SinaEditor.util.styleHTML=function(html_source,indent_size,indent_character,max_char){var Parser,multi_parser;Parser=function(){this.pos=0;this.token='';this.current_mode='CONTENT';this.tags={parent:'parent1',parentcount:1,parent1:''};this.tag_type='';this.token_text=this.last_token=this.last_text=this.token_type='';this.Utils={whitespace:"\n\r\t ".split(''),single_token:'br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed'.split(','),extra_liners:'head,body,/html'.split(','),in_array:function(what,arr){var i;for(i=0;i<arr.length;i++){if(what===arr[i]){return true}}return false}};this.get_content=function(){var input_char='';var content=[];var space=false;while(this.input.charAt(this.pos)!=='<'){if(this.pos>=this.input.length){return content.length?content.join(''):['','TK_EOF']}input_char=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(input_char,this.Utils.whitespace)){if(content.length){space=true}this.line_char_count--;continue}else if(space){if(this.line_char_count>=this.max_char){content.push('\n');var i;for(i=0;i<this.indent_level;i++){content.push(this.indent_string)}this.line_char_count=0}else{content.push(' ');this.line_char_count++}space=false}content.push(input_char)}return content.length?content.join(''):''};this.get_script=function(){var input_char='';var content=[];var reg_match=new RegExp('\<\/script'+'\>','igm');reg_match.lastIndex=this.pos;var reg_array=reg_match.exec(this.input);var end_script=reg_array?reg_array.index:this.input.length;while(this.pos<end_script){if(this.pos>=this.input.length){return content.length?content.join(''):['','TK_EOF']}input_char=this.input.charAt(this.pos);this.pos++;content.push(input_char)}return content.length?content.join(''):''};this.record_tag=function(tag){if(this.tags[tag+'count']){this.tags[tag+'count']++;this.tags[tag+this.tags[tag+'count']]=this.indent_level}else{this.tags[tag+'count']=1;this.tags[tag+this.tags[tag+'count']]=this.indent_level}this.tags[tag+this.tags[tag+'count']+'parent']=this.tags.parent;this.tags.parent=tag+this.tags[tag+'count']};this.retrieve_tag=function(tag){if(this.tags[tag+'count']){var temp_parent=this.tags.parent;while(temp_parent){if(tag+this.tags[tag+'count']===temp_parent){break}temp_parent=this.tags[temp_parent+'parent']}if(temp_parent){this.indent_level=this.tags[tag+this.tags[tag+'count']];this.tags.parent=this.tags[temp_parent+'parent']}delete this.tags[tag+this.tags[tag+'count']+'parent'];delete this.tags[tag+this.tags[tag+'count']];if(this.tags[tag+'count']==1){delete this.tags[tag+'count']}else{this.tags[tag+'count']--}}};this.get_tag=function(){var input_char='';var comment;var content=[];var space=false;do{if(this.pos>=this.input.length){return content.length?content.join(''):['','TK_EOF']}input_char=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(input_char,this.Utils.whitespace)){space=true;this.line_char_count--;continue}if(input_char==="'"||input_char==='"'){if(!content[1]||content[1]!=='!'){input_char+=this.get_unformatted(input_char);space=true}}if(input_char==='='){space=false}if(content.length&&content[content.length-1]!=='='&&input_char!=='>'&&space){if(this.line_char_count>=this.max_char){this.print_newline(false,content);this.line_char_count=0}else{content.push(' ');this.line_char_count++}space=false}content.push(input_char)}while(input_char!=='>');var tag_complete=content.join('');var tag_index;if(tag_complete.indexOf(' ')!=-1){tag_index=tag_complete.indexOf(' ')}else{tag_index=tag_complete.indexOf('>')}var tag_check=tag_complete.substring(1,tag_index).toLowerCase();if(tag_complete.charAt(tag_complete.length-2)==='/'||this.Utils.in_array(tag_check,this.Utils.single_token)){this.tag_type='SINGLE'}else if(tag_check==='script'){this.record_tag(tag_check);this.tag_type='SCRIPT'}else if(tag_check==='style'){this.record_tag(tag_check);this.tag_type='STYLE'}else if(tag_check==='a'){comment=this.get_unformatted('</a>',tag_complete);content.push(comment);this.tag_type='SINGLE'}else if(tag_check.charAt(0)==='!'){if(tag_check.indexOf('[if')!=-1){if(tag_complete.indexOf('!IE')!=-1){comment=this.get_unformatted('-->',tag_complete);content.push(comment)}this.tag_type='START'}else if(tag_check.indexOf('[endif')!=-1){this.tag_type='END';this.unindent()}else if(tag_check.indexOf('[cdata[')!=-1){comment=this.get_unformatted(']]>',tag_complete);content.push(comment);this.tag_type='SINGLE'}else{comment=this.get_unformatted('-->',tag_complete);content.push(comment);this.tag_type='SINGLE'}}else{if(tag_check.charAt(0)==='/'){this.retrieve_tag(tag_check.substring(1));this.tag_type='END'}else{this.record_tag(tag_check);this.tag_type='START'}if(this.Utils.in_array(tag_check,this.Utils.extra_liners)){this.print_newline(true,this.output)}}return content.join('')};this.get_unformatted=function(delimiter,orig_tag){if(orig_tag&&orig_tag.indexOf(delimiter)!=-1){return''}var input_char='';var content='';var space=true;do{input_char=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(input_char,this.Utils.whitespace)){if(!space){this.line_char_count--;continue}if(input_char==='\n'||input_char==='\r'){content+='\n';var i;for(i=0;i<this.indent_level;i++){content+=this.indent_string}space=false;this.line_char_count=0;continue}}content+=input_char;this.line_char_count++;space=true}while(content.indexOf(delimiter)==-1);return content};this.get_token=function(){var token;if(this.last_token==='TK_TAG_SCRIPT'){var temp_token=this.get_script();if(typeof temp_token!=='string'){return temp_token}token=js_beautify(temp_token,{indent_size:this.indent_size,indent_char:this.indent_character,indent_level:this.indent_level});return[token,'TK_CONTENT']}if(this.current_mode==='CONTENT'){token=this.get_content();if(typeof token!=='string'){return token}else{return[token,'TK_CONTENT']}}if(this.current_mode==='TAG'){token=this.get_tag();if(typeof token!=='string'){return token}else{var tag_name_type='TK_TAG_'+this.tag_type;return[token,tag_name_type]}}};this.printer=function(js_source,indent_character,indent_size,max_char){this.input=js_source||'';this.output=[];this.indent_character=indent_character||' ';this.indent_string='';this.indent_size=indent_size||2;this.indent_level=0;this.max_char=max_char||70;this.line_char_count=0;var i;for(i=0;i<this.indent_size;i++){this.indent_string+=this.indent_character}this.print_newline=function(ignore,arr){this.line_char_count=0;if(!arr||!arr.length){return}if(!ignore){while(this.Utils.in_array(arr[arr.length-1],this.Utils.whitespace)){arr.pop()}}arr.push('\n');var i;for(i=0;i<this.indent_level;i++){arr.push(this.indent_string)}};this.print_token=function(text){this.output.push(text)};this.indent=function(){this.indent_level++};this.unindent=function(){if(this.indent_level>0){this.indent_level--}}};return this};multi_parser=new Parser();multi_parser.printer(html_source,indent_character,indent_size);while(true){var t=multi_parser.get_token();multi_parser.token_text=t[0];multi_parser.token_type=t[1];if(multi_parser.token_type==='TK_EOF'){break}switch(multi_parser.token_type){case'TK_TAG_START':case'TK_TAG_SCRIPT':case'TK_TAG_STYLE':multi_parser.print_newline(false,multi_parser.output);multi_parser.print_token(multi_parser.token_text);multi_parser.indent();multi_parser.current_mode='CONTENT';break;case'TK_TAG_END':multi_parser.print_newline(true,multi_parser.output);multi_parser.print_token(multi_parser.token_text);multi_parser.current_mode='CONTENT';break;case'TK_TAG_SINGLE':multi_parser.print_newline(false,multi_parser.output);multi_parser.print_token(multi_parser.token_text);multi_parser.current_mode='CONTENT';break;case'TK_CONTENT':if(multi_parser.token_text!==''){multi_parser.print_newline(false,multi_parser.output);multi_parser.print_token(multi_parser.token_text)}multi_parser.current_mode='TAG';break}multi_parser.last_token=multi_parser.token_type;multi_parser.last_text=multi_parser.token_text}return multi_parser.output.join('')};if(!SinaEditor.util){SinaEditor.util={};SinaEditor.util.dom={}}SinaEditor.pkg('SinaEditor.util.dom',function(ns){ns.createDom=function(nodeName,option){option=option||{};var ele=(option.ownerDocument||document).createElement(nodeName);var k;if(option.attributes){for(k in option.attributes){ele.setAttribute(k,option.attributes[k])}}if(option.properties){for(k in option.properties){ele[k]=option.properties[k]}}return ele};ns.containsNode=function(parent,child){if(parent==child){return true}if(parent.contains){return parent.contains(child)}else{return!!(parent.compareDocumentPosition(child)&16)}};ns.getFirst=function(elem){elem=elem.firstChild;return elem&&elem.nodeType!=SinaEditor.NODETYPE.ELEMENT?ns.getNext(elem):elem};ns.getNext=function(elem){do{elem=elem.nextSibling}while(elem&&elem.nodeType!=1);return elem};ns.parents=function(elem){var parents=[];var p=elem.parentNode;while(p.tagName.toUpperCase()!='HTML'){parents[parents.length]=p;p=p.parentNode}return parents};ns.createDomFromHTML=function(html,ownerDocument){var div=ns.createDom('DIV',{'ownerDocument':ownerDocument});div.innerHTML=html;return div.removeChild(div.firstChild)};ns.outerHTML=function(element){if(element.outerHTML){console.log('native outerHTML');return element.outerHTML}var div=element.ownerDocument.createElement('div');div.appendChild(element.cloneNode(true));return div.innerHTML};if(SinaEditor.env.$IE){ns.replaceNode=function(newChild,oldChild){return oldChild.replaceNode(newChild)}}else{ns.replaceNode=function(newChild,oldChild){return oldChild.parentNode.replaceChild(newChild,oldChild)}}ns.delElement=function(element){var parentNode=element.parentNode;if(parentNode){return parentNode.removeChild(element)}else{return null}};ns.removeTag=function(elm){if(elm.nodeType!=1){return}var parent=elm.parentNode;var children=elm.childNodes;while(children[0]){parent.insertBefore(children[0],elm)}parent.removeChild(elm)};ns.getBlockParent=function(dom){var ps=ns.parents(dom);var blockElm=null;var i;for(i=0;ps[i];i++){if(SinaEditor.RANGE.BLOCKTAGS[ps[i].tagName.toUpperCase()]){break}blockElm=ps[i]}return blockElm};ns.insertBefore=function(newElem,reElem){reElem.parentNode.insertBefore(newElem,reElem)};ns.insertAfter=function(newElem,reElem){var parentEl=reElem.parentNode;if(parentEl.lastChild==reElem){parentEl.appendChild(newElem)}else{parentEl.insertBefore(newElem,reElem.nextSibling)}};ns.getScrollPos=function(oDocument){oDocument=oDocument||document;var _model=oDocument.compatMode;var ref=_model==='BackCompat'?oDocument.body:oDocument.documentElement;return[ref.scrollTop||oDocument.body.scrollTop,ref.scrollLeft||oDocument.body.scrollLeft,ref.scrollWidth,ref.scrollHeight]};ns.$E=function(id,doc){var node=typeof id=="string"?(doc||document).getElementById(id):id;if(node){return node}return null};function _pageX(el,noscoll){var dx=el.scrollLeft;if(noscoll){return el.offsetParent?el.offsetLeft+_pageX(el.offsetParent,noscoll)-dx:el.offsetLeft-dx}return el.offsetParent?el.offsetLeft+_pageX(el.offsetParent,noscoll):el.offsetLeft}function _pageY(el,noscoll){var dy=el.scrollTop;if(noscoll){return el.offsetParent?el.offsetTop+_pageY(el.offsetParent,noscoll)-dy:el.offsetTop-dy}return el.offsetParent?el.offsetTop+_pageY(el.offsetParent,noscoll):el.offsetTop}ns.getXY=function(el,inIframe){if(!inIframe){return[_pageX(el),_pageY(el)]}var doc;var frame;var pframe;var pos=[0,0];var ie=true;doc=el.ownerDocument;if(doc.parentWindow){frame=doc.parentWindow.frameElement;pframe=frame&&frame.ownerDocument.parentWindow.frameElement}else{frame=doc.defaultView.frameElement;pframe=frame&&frame.ownerDocument.defaultView.frameElement;ie=false}while(frame){pos[0]+=ns.styleInteger(frame,"borderLeftWidth");pos[1]+=ns.styleInteger(frame,"borderTopWidth");if(pframe){pos[0]+=_pageX(frame,true);pos[1]+=_pageY(frame,true);frame=pframe;if(ie){pframe=frame.ownerDocument.parentWindow.frameElement}else{pframe=frame.ownerDocument.defaultView.frameElement}}else{pos[0]+=_pageX(frame);pos[1]+=_pageY(frame);frame=pframe}}return[pos[0]+_pageX(el,true),pos[1]+_pageY(el,true)]};ns.getChildren=function(elements,opts){opts=opts||{};opts.eleArr=opts.eleArr||[];if(elements.nodeType==3&&!opts.onlyElement){opts.eleArr.push(elements)}else{var children=elements.childNodes;var i=0;while(children[i]){var ch=children[i];if(ch.nodeType==1){if(opts.all&&(ch.childNodes.length!=1||(ch.childNodes.length==1&&ch.childNodes[0].nodeType!=3))){opts.eleArr=ns.getChildren(ch,opts)}opts.eleArr.push(ch)}else{if(!opts.onlyElement){opts.eleArr.push(ch)}}i++}}return opts.eleArr}});SinaEditor.pkg('SinaEditor.util.dom',function(ns){ns.addStyles=function(str,ownerDocument){var style;var head;head=(ownerDocument||document).getElementsByTagName('head')[0];style=ns.createDom('style',{'ownerDocument':ownerDocument,'attributes':{'type':'text/css'}});try{style.appendChild((ownerDocument||document).createTextNode(str))}catch(ex){style.styleSheet.cssText=str}head.appendChild(style)};ns.addLink=function(href,ownerDocument){var link;var head;head=(ownerDocument||document).getElementsByTagName('head')[0];link=ns.createDom('link',{'ownerDocument':ownerDocument,'attributes':{'rel':'stylesheet','type':'text/css','href':href}});head.appendChild(link)};ns.styleInteger=function(el,style){var val=ns.getStyle(el,style);try{return parseInt(val.replace(/[^\d]/g,''),10)||0}catch(e){return 0}};ns.getStyle=function(el,property){if(!el){return''}switch(el.nodeType){case SinaEditor.NODETYPE.HTMLELEMENT:return'';case SinaEditor.NODETYPE.TEXT:el=el.parentNode}if(!el||el.tagName.toUpperCase()==='BODY'){return''}switch(property){case"opacity":var val=100;try{var key='DXImageTransform.Microsoft.Alpha';val=el.filters[key].opacity}catch(e){try{val=el.filters('alpha').opacity}catch(e){}}return val/100;default:if(property==='float'){property="styleFloat"}var value=el.currentStyle?el.currentStyle[property]:null;return(el.style[property]||value)}};if(!SinaEditor.env.$IE){ns.getStyle=function(el,property){if(!el){return''}switch(el.nodeType){case SinaEditor.NODETYPE.HTMLELEMENT:return'';case SinaEditor.NODETYPE.TEXT:el=el.parentNode}if(!el||el.tagName.toUpperCase()==='BODY'){return''}if(property=="float"){property="cssFloat"}var computed=el.ownerDocument.defaultView.getComputedStyle(el,"");return el.style[property]||computed?computed[property]:null}}var toStyleAttribute=function(styleName){var arr=styleName.split('-');var cc=arr[0];var i;for(i=1;i<arr.length;i++){cc+=arr[i].charAt(0).toUpperCase()+arr[i].substring(1)}return cc};ns.removeStyle=function(elm,styleName){styleName=styleName.replace(/([A-Z])/,'-$1').toLowerCase();var cssTexts=elm.style.cssText.toLowerCase().split(';');var i;for(i=0;cssTexts[i];i++){if(cssTexts[i].indexOf(styleName)!=-1){cssTexts.splice(i,1);break}}elm.style.cssText=cssTexts.join(';');return cssTexts.length-1};ns.setStyle=function(){var el=arguments[0];if(arguments.length==2){var styleAttr,name;var style=arguments[1];for(name in style){styleAttr=toStyleAttribute(name);ns.setStyle(el,styleAttr,style[name])}}else if(arguments.length==3){var property=arguments[1];var val=arguments[2];if(!SinaEditor.env.$IE){if(property=="float"){property="cssFloat"}el.style[property]=val}else{switch(property){case"opacity":el.style.filter="alpha(opacity="+(val*100)+")";if(!el.currentStyle||!el.currentStyle.hasLayout){el.style.zoom=1}break;case"float":property="styleFloat";break;default:el.style[property]=val}}}}});if(!SinaEditor.range){SinaEditor.range={}}SinaEditor.pkg('SinaEditor.range',function(ns){var domUtil=SinaEditor.util.dom;var _queryStateArr={};var _createRange=function(editor){return editor.entyDoc.createRange()};ns.getCurrentRanges=function(win){var selection=win.getSelection();if(!selection){return[]}var rangeArr=[];var count=selection.rangeCount;if(!count){var range=win.document.createRange();if(!win.document.body.firstChild){win.document.body.innerHTML='&#x200b;'}range.selectNode(win.document.body.firstChild);range.collapse(true);return[range]}var i,tmpRange;for(i=0;i<count;i++){tmpRange=_resetRange(selection.getRangeAt(i));rangeArr.push(tmpRange)}return rangeArr};var _resetRange=function(range){if(range.collapsed){return range}var tmpRange=range.cloneRange();var oldStart=range.startContainer;var newStart=_whichOne(oldStart);while(newStart){range.setStartBefore(newStart);if(range.toString()!==tmpRange.toString()){break}oldStart=newStart;newStart=_whichOne(oldStart)}if(oldStart===tmpRange.startContainer){range.setStart(oldStart,tmpRange.startOffset)}else{range.setStartBefore(oldStart)}var oldEnd=range.endContainer;var newEnd=_whichOne(oldEnd);while(newEnd){range.setEndAfter(newEnd);if(range.toString()!==tmpRange.toString()){break}oldEnd=newEnd;newEnd=_whichOne(oldEnd)}if(oldEnd===tmpRange.endContainer){range.setEnd(oldEnd,tmpRange.endOffset)}else{range.setEndAfter(oldEnd)}tmpRange.detach();return range};var _whichOne=function(elm){var p,pp;p=elm.parentNode;if(!p||p.nodeType===SinaEditor.NODETYPE.HTMLELEMENT||p.tagName.toUpperCase()==='HTML'||p.tagName.toUpperCase()==='BODY'){return null}pp=p.parentNode;if(pp&&p){var cs=pp.childNodes;for(var i=0;cs[i];i++){if(cs[i]===p){return p}}}return null};ns.applyRanges=function(win,ranges){if(!ranges){return}var selection=win.getSelection();selection.removeAllRanges();if(ranges.push){var i;for(i=0;ranges[i];i++){selection.addRange(ranges[i])}}else{selection.addRange(ranges)}};ns.focusNode=function(win,opt_onlyEle){var node=null;if(SinaEditor.env.$IE){var range=win.document.selection.createRange();node=range.item?range.item(0):range.parentElement();if(opt_onlyEle&&node.nodeType!=1){return node.parentNode}return node}var selection=win.getSelection();var rangeArr=[];var count=selection.rangeCount;var i;for(i=0;i<count;i++){node=selection.getRangeAt(i).commonAncestorContainer;if(opt_onlyEle&&node.nodeType!=1){return node.parentNode}return node}return null};ns.getReferNode=function(win,range){range=range||ns.getCurrentRanges(win)[0];if(!range){return null}var referNode=range.startContainer;switch(referNode.nodeType){case SinaEditor.NODETYPE.ELEMENT:switch(referNode.tagName.toUpperCase()){case'BODY':return SinaEditor.util.dom.getFirst(referNode);default:return referNode.parentNode}case SinaEditor.NODETYPE.TEXT:console.log('SinaEditor.NODETYPE.TEXT');var parent=referNode.parentNode;parent.normalize();if(parent.childNodes.length==1){return parent}return referNode}};ns.focus=function(dom,isContent){var win=dom.ownerDocument.parentWindow|dom.ownerDocument.defaultView;var selection=win.getSelection();var range=win.document.createRange();if(isContent){range.selectNodeContents(dom)}else{range.selectNode(dom)}selection.removeAllRanges();selection.addRange(range);return selection};ns.setStartBefore=function(win,dom){var selection=win.getSelection();var range=win.document.createRange();range.setStartBefore(dom);selection.removeAllRanges();selection.addRange(range);return selection};ns.insertNode=function(win,dom){var selection=win.getSelection();var range;if(selection.rangeCount>0){range=selection.getRangeAt(0)}else{range=win.document.createRange()}range.insertNode(dom);return selection};ns.compareBoundaryPoints=function(firstRange,secondRange,how){if(!firstRange){return-1}if(!secondRange){return 1}how=how||Range.START_TO_END;return firstRange.compareBoundaryPoints(how,secondRange)};ns.applyStyle=function(editor,styleConf){styleConf.useTagName=styleConf.useTagName||'span';var range=ns.getCurrentRanges(editor.entyWin)[0];editor.entyDoc.normalize();if(range.collapsed){var elm=null;var startContainer=range.startContainer;if(startContainer.nodeType===SinaEditor.NODETYPE.ELEMENT&&startContainer.tagName.toUpperCase()===styleConf.useTagName.toUpperCase()&&startContainer.innerHTML==='â€‹'){elm=startContainer}else{elm=domUtil.createDom(styleConf.useTagName,{'ownerDocument':editor.entyDoc});elm.innerHTML='&#x200b;';range.insertNode(elm)}if(styleConf.style){elm.style[styleConf.style]=styleConf.value}range.selectNodeContents(elm);range.collapse(false);ns.applyRanges(editor.entyWin,range);editor.focus();return}var marks=_createBookmark(editor,{'range':range});if(marks.end){_breakParent.call(editor,marks.end)}_breakParent.call(editor,marks.start);_getNextNode(marks.start,marks.end,function(currEle){if(currEle.nodeType==3&&currEle.data){currEle=_handleTextSelected(editor,currEle,{'useTagName':styleConf.useTagName.toUpperCase(),'style':styleConf.style,'value':styleConf.value})}else if(currEle.nodeType==1&&(currEle.textContent||currEle.innerText)){if(!SinaEditor.RANGE.SKIPTAGS[currEle.tagName.toUpperCase()]){currEle=_handleElementSelected(editor,currEle,{'useTagName':styleConf.useTagName.toUpperCase(),'style':styleConf.style,'value':styleConf.value})}}});if(marks.end){range.setEndBefore(marks.end);marks.end.parentNode.removeChild(marks.end)}range.setStartAfter(marks.start);marks.start.parentNode.removeChild(marks.start);ns.applyRanges(editor.entyWin,range);editor.focus()};ns.queryCommandState=function(doc,queryStr){if(!queryStr){return false}queryStr=queryStr.toLowerCase();if(_queryStateArr[queryStr]){return _queryStateArr[queryStr](ns.getReferNode(doc.defaultView||doc.parentWindow))}return doc.queryCommandState(queryStr)};ns.regQueryCommandState=function(queryStr,callback){queryStr=queryStr.toLowerCase();if(_queryStateArr[queryStr]){return}_queryStateArr[queryStr]=callback};ns.removeStyle=function(editor,styleConf,noBreak){styleConf.useTagName=styleConf.useTagName||'span';var refTags={};if(typeof styleConf.useTagName==='string'){refTags[styleConf.useTagName.toUpperCase()]='1'}else{var i;for(i=0;styleConf.useTagName[i];i++){refTags[styleConf.useTagName[i].toUpperCase()]='1'}}var range=ns.getCurrentRanges(editor.entyWin)[0];if(range.collapsed){editor.focus();return}var marks=_createBookmark(editor,{'range':range});editor.entyDoc.normalize();if(!noBreak){_breakParent.call(editor,marks.end);_breakParent.call(editor,marks.start)}_getNextNode(marks.start,marks.end,function(currEle){if(currEle.nodeType===SinaEditor.NODETYPE.ELEMENT&&refTags[currEle.tagName.toUpperCase()]){if(styleConf.style){var len=SinaEditor.util.dom.removeStyle(currEle,styleConf.style);if(len===0){domUtil.removeTag(currEle)}}else{domUtil.removeTag(currEle)}}});if(marks.end){range.setEndBefore(marks.end);marks.end.parentNode.removeChild(marks.end)}range.setStartAfter(marks.start);marks.start.parentNode.removeChild(marks.start);ns.applyRanges(editor.entyWin,range);editor.focus()};var _getNextNode=function(begin,end,callBack){var current=__getNextElement(begin,true);while(current&&current!=end){var handleEle=current;current=__getNextElement(current);if(handleEle.nodeType===SinaEditor.NODETYPE.TEXT||(handleEle.nodeType===SinaEditor.NODETYPE.ELEMENT&&!SinaEditor.util.dom.containsNode(handleEle,end))){callBack(handleEle)}}};var __getNextElement=function(elm,skipChildren){if(elm.hasChildNodes()&&!skipChildren){var firstEl=elm.firstChild;if(firstEl){return firstEl}}var nextEl=elm.nextSibling;while(!nextEl){nextEl=elm.parentNode;if(nextEl.tagName.toUpperCase()=='HTML'){throw'Have you closed all node tags?'}elm=nextEl;nextEl=elm.nextSibling}return nextEl};var _createBookmark=function(editor,opts){opts=opts||{};var spanHead;var spanEnd;spanHead=domUtil.createDom('span',{'ownerDocument':editor.entyDoc,properties:{'innerHTML':'&nbsp;'},attributies:{'_se_mark':1}});spanHead.style.color='#FF0000';opts.range=opts.range||_createRange(editor);if(!opts.range.collapsed){spanEnd=domUtil.createDom('span',{'ownerDocument':editor.entyDoc,properties:{'innerHTML':'&nbsp;'},attributies:{'_se_mark':2}});spanEnd.style.color='#FF0000';var clone=opts.range.cloneRange();clone.collapse(false);clone.insertNode(spanEnd)}clone=opts.range.cloneRange();clone.collapse(true);clone.insertNode(spanHead);if(spanEnd){opts.range.setStartAfter(spanHead);opts.range.setEndBefore(spanEnd)}else{opts.range.setStartAfter(spanHead);opts.range.collapse(true)}ns.applyRanges(editor.entyWin,opts.range);return{start:spanHead,end:spanEnd}};var _breakParent=function(child){var parent=domUtil.getBlockParent(child);if(!parent){return false}var range=_createRange(this);range.setStartAfter(child);range.setEndAfter(parent);var docFrag=range.extractContents();range.insertNode(domUtil.delElement(child));domUtil.insertAfter(docFrag,child);return true};function _handleTextSelected(editor,element,conf){var range=_createRange(editor);var span=domUtil.createDom(conf.useTagName,{'ownerDocument':editor.entyDoc});if(conf.style){span.style[conf.style]=conf.value}var parent=element.parentNode;if(parent.tagName.toUpperCase()===conf.useTagName){console.log("Parent node is span!");if(SinaEditor.util.trim(parent.textContent)!=SinaEditor.util.trim(element.data)){range.selectNode(element);range.surroundContents(span);return span}if(conf.style){parent.style[conf.style]=conf.value}return parent}if(parent.tagName.toUpperCase()=='BODY'){console.log("Parent node is Body!");range.selectNode(element);range.surroundContents(span);return span}else{if(SinaEditor.RANGE.BLOCKTAGS[element.parentNode.tagName.toUpperCase()]){console.log("Element is block");range.selectNode(element);range.surroundContents(span);return span}else{console.log("Element isn't block");var pParent=parent.parentNode;if(pParent&&pParent.nodeType===SinaEditor.NODETYPE.ELEMENT&&pParent.tagName.toUpperCase()==conf.useTagName){console.log("Parent node's parent node is span");if(SinaEditor.util.trim(pParent.textContent)==SinaEditor.util.trim(element.data)){if(conf.style){pParent.style[conf.style]=conf.value}return pParent}else{range.selectNode(element);range.surroundContents(span);return span}}else{console.log("Parent node's parent node isn't span, but:");console.log(pParent);if(SinaEditor.util.trim(parent.textContent)==SinaEditor.util.trim(element.data)){range.selectNode(parent)}else{range.selectNode(element)}range.surroundContents(span);return span}}}}function _handleElementSelected(editor,element,conf){console.log('DOM node');console.log(element);if(SinaEditor.RANGE.SKIPTAGS[element.tagName.toUpperCase()]){return element}var retEle=element;var range=_createRange(editor);var span=domUtil.createDom(conf.useTagName,{'ownerDocument':editor.entyDoc});if(conf.style){span.style[conf.style]=conf.value}var eles=domUtil.getChildren(element,{'all':true,'onlyElement':true});if(element.tagName.toUpperCase()===conf.useTagName){console.log("span");var arr=domUtil.getChildren(element,{'all':true,'onlyElement':true});var num=0;while(arr[num]){if(arr[num].tagName.toUpperCase()===conf.useTagName&&!arr[num].style.cssText){var tmpRange=_createRange(editor);tmpRange.selectNode(arr[num]);var txtNode=editor.entyDoc.createTextNode(tmpRange.extractContents().textContent);tmpRange.insertNode(txtNode);tmpRange.detach()}num++}if(conf.style){element.style[conf.style]=conf.value}}else{if(SinaEditor.RANGE.BLOCKTAGS[element.tagName.toUpperCase()]){console.log("block tag");var children=element.childNodes;if(children.length===SinaEditor.NODETYPE.ELEMENT&&children[0].nodeType==SinaEditor.NODETYPE.ELEMENT&&children[0].tagName.toUpperCase()==conf.useTagName){console.log("the only child node is span");if(conf.style){children[0].style[conf.style]=conf.value}}else{console.log("no child node or child node isn't span element");range.selectNodeContents(element);range.surroundContents(span)}}else{console.log("not block element");var parent=element.parentNode;if(parent&&parent.tagName.toUpperCase()==conf.useTagName){console.log("Parent node is span");if(conf.style){parent.style[conf.style]=conf.value}retEle=parent}else{console.log("No parent node or parent node isn't span");range.selectNode(element);range.surroundContents(span);retEle=span}}}return retEle}});SinaEditor.ev.customEvent.ctrlb=function(editor){return[{'enty':editor.entyDoc,'events':{'keydown':function(e){if(e.ctrlKey&&e.keyCode==66){SinaEditor.ev.stopEvent(e);SinaEditor.ev.fire(editor,'ctrlb')}}}}]};SinaEditor.ev.customEvent.ctrli=function(editor){return[{'enty':editor.entyDoc,'events':{'keydown':function(e){if(e.ctrlKey&&e.keyCode==73){SinaEditor.ev.stopEvent(e);SinaEditor.ev.fire(editor,'ctrli')}}}}]};SinaEditor.ev.customEvent.ctrls=function(editor){return[{'enty':editor.entyDoc,'events':{'keydown':function(e){if(e.ctrlKey&&e.keyCode==83){SinaEditor.ev.stopEvent(e);SinaEditor.ev.fire(editor,'ctrls')}}}}]};SinaEditor.ev.customEvent.ctrly=function(editor){return[{'enty':editor.entyDoc,'events':{'keydown':function(e){if(e.ctrlKey&&e.keyCode==89){SinaEditor.ev.stopEvent(e);SinaEditor.ev.fire(editor,'ctrly')}}}}]};SinaEditor.ev.customEvent.ctrlz=function(editor){return[{'enty':editor.entyDoc,'events':{'keydown':function(e){if(e.ctrlKey&&e.keyCode==90){SinaEditor.ev.stopEvent(e);SinaEditor.ev.fire(editor,'ctrlz')}}}}]};SinaEditor.ev.customEvent.editorHasSelection=function(editor){function doo(){editor.entyWin.clearTimeout(editor._.editorHasSelectionBufferTimmer);editor._.editorHasSelectionBufferTimmer=editor.entyWin.setTimeout(function(){console.log("Check every 1 second");var ranges=SinaEditor.range.getCurrentRanges(editor.entyWin);var i;for(i=0;ranges[i];i++){if(!ranges[i].collapsed){console.log('Selection found');return}}console.log('No selection')},1000)}};SinaEditor.ev.customEvent.editorOnladed=function(editor){};SinaEditor.ev.customEvent.editorSelectionChange=function(editor){var _listener=function(e){editor.entyWin.clearTimeout(editor._.editorHasSelectionBufferTimmer);editor._.editorHasSelectionBufferTimmer=editor.entyWin.setTimeout(function(){var ranges=SinaEditor.range.getCurrentRanges(editor.entyWin);var current0=ranges[0];var old0;if(!editor._.oldRange){_handleEvent.call(editor,e,current0)}else{old0=editor._.oldRange[0];if(current0||old0){if(SinaEditor.range.compareBoundaryPoints(current0,old0)!==0){_handleEvent.call(editor,e,current0)}}}editor._.oldRange=ranges},400)};var _handleEvent=function(e,range){e=SinaEditor.ev.fixEvent(e);SinaEditor.ev.fire(editor,'editorSelectionChange',{'args':[range,SinaEditor.range.getReferNode(this.entyWin,range)]})};return[{'enty':editor.entyDoc,'events':{'mouseup':_listener,'keyup':_listener}}]};SinaEditor.ev.customEvent.editorStateChange=function(editor){};SinaEditor.ev.customEvent.redoAndUndoChanged=function(editor){};if(!SinaEditor.$abstract){SinaEditor.$abstract={}}SinaEditor.$abstract.$BaseBubble=function(){this.enbad=SinaEditor.util.dom.createDom('div');this.enbad.style.display='none';var me=this;if(document.body){document.body.appendChild(me.enbad)}else{SinaEditor.ev.add(window,'load',function(e){document.body.appendChild(me.enbad)})}}.$define({showBubble:function(content,option){if(typeof content=='string'){this.enbad.innerHTML=content}else{this.enbad.appendChild(content)}this.enbad.style.left=option.x+'px';var dy=SinaEditor.util.dom.styleInteger(this.enbad,'paddingTop')+SinaEditor.util.dom.styleInteger(this.enbad,'paddingBottom')+SinaEditor.util.dom.styleInteger(this.enbad,'marginTop')+SinaEditor.util.dom.styleInteger(this.enbad,'marginBottom')+SinaEditor.util.dom.styleInteger(this.enbad,'borderTopWidth')+SinaEditor.util.dom.styleInteger(this.enbad,'borderBottomWidth');this.enbad.style.top=(option.y-dy)+'px';return this},hiddenBubble:function(){this.enbad.style.display='none';this.enbad.innerHTML='';return this},id:function(id){return this.enbad.ownerDocument.getElementById(id)}});if(!SinaEditor.$abstract){SinaEditor.$abstract={}}SinaEditor.$abstract.$BaseButton=function(option,editor){this.option=option;this._customSetStatus=option.setState}.$define({eventInit:function(option,editor){var btn=this;var type=option.editorChangeType||'default';var i=0;if(option.init){option.init.call(this)}if(option.events){for(i=0;option.events[i];i++){SinaEditor.ev.add(this.$,option.events[i].name,option.events[i].callback)}}if(option.mouseoverClass){var me=this;SinaEditor.ev.add(this.$,'mouseover',function(){if(me._state==SinaEditor.BUTTONSTATE.CLICKED){return}if(me._state==SinaEditor.BUTTONSTATE.DISABLED){return}me.$.className=me.option.mouseoverClass;if(me.option.mouseover){me.option.mouseover(me.$)}});SinaEditor.ev.add(this.$,'mouseout',function(){me.setState(me._state)})}if(!option.unselected){if(SinaEditor.env.$GENKO){this.$.style.MozUserSelect='none'}else if(SinaEditor.env.$WEBKIT){this.$.style.WebkitUserSelect='none'}else{this.$.setAttribute('unselectable','on')}}this.setState(option.state||SinaEditor.BUTTONSTATE.NORMAL);SinaEditor.ev.add(editor,'editorStateChange',function(){SinaEditor.BUTTON[type].call(this,btn)})},setState:function(state){this._state=state;if(this._customSetStatus){this._customSetStatus.apply(this,arguments)}var option=this.option;if(option.noEvent){return}var key,s;for(s in SinaEditor.BUTTONSTATE){if(SinaEditor.BUTTONSTATE[s]==state){key=s.toLowerCase();this.$.className=option[key+'Class'];if(option[key]){option[key](this.$)}break}}},getState:function(){return this._state}});if(!SinaEditor.$abstract){SinaEditor.$abstract={}}SinaEditor.$abstract.Storage=(function(){var proxyObj={};var setItem=function(){};var length=function(){};var key=function(){};var getItem=function(){};var removeItem=function(){};var clear=function(){};var saveObj=window.localStorage||(window.globalStorage&&globalStorage[location.host]);if(saveObj){proxyObj.setItem=function(key,value){try{saveObj.setItem(key,SinaEditor.util.o2s(value));return true}catch(e){return false}};proxyObj.length=function(){return saveObj.length};proxyObj.key=function(index){var str=saveObj.key(index);return str?SinaEditor.util.s2o(str):str};proxyObj.getItem=function(key){var str=saveObj.getItem(key);return str?SinaEditor.util.s2o(str):str};proxyObj.removeItem=function(key){saveObj.removeItem(key)};proxyObj.clear=function(){if(saveObj.clear){saveObj.clear()}else{while(saveObj.length){proxyObj.removeItem(proxyObj.key(0))}}}}else{saveObj=document.createElement('div');saveObj.addBehavior("#default#userData");document.body.appendChild(saveObj);saveObj.load('SinaEditor');proxyObj.setItem=function(key,value){try{var added=false;var tmp=SinaEditor.util.s2o(saveObj.getAttribute('saveObj'))||[];var i;for(i=0;tmp[i];i++){if(tmp[i][key]){tmp[i][key]=value;added=true}}if(!added){var obj={};obj[key]=value;tmp.push(obj)}saveObj.setAttribute('saveObj',SinaEditor.util.o2s(tmp));saveObj.save('SinaEditor');return true}catch(e){return false}};proxyObj.length=function(){var tmp=SinaEditor.util.s2o(saveObj.getAttribute('saveObj'))||[];return tmp.length};proxyObj.key=function(index){var tmp=SinaEditor.util.s2o(saveObj.getAttribute('saveObj'))||[];if(tmp[index]){var ret;for(ret in tmp[index]){return ret}}return null};proxyObj.getItem=function(key){var tmp=SinaEditor.util.s2o(saveObj.getAttribute('saveObj'))||[];var i;for(i=0;tmp[i];i++){if(tmp[i][key]){return tmp[i][key]}}return null};proxyObj.removeItem=function(key){var tmp=SinaEditor.util.s2o(saveObj.getAttribute('saveObj'))||[];var i;for(i=0;tmp[i];i++){if(tmp[i][key]){tmp.splice(i,1);saveObj.setAttribute('saveObj',SinaEditor.util.o2s(tmp));saveObj.save('SinaEditor');return}}};proxyObj.clear=function(){saveObj.setAttribute('saveObj',SinaEditor.util.o2s([]));saveObj.save('SinaEditor')}}return proxyObj})();if(!SinaEditor.$abstract){SinaEditor.$abstract={}}SinaEditor.$abstract.Template=function(tmpl){this.tmpl=tmpl;this.pattern=/(#\{([^\}]+)(?=\})})/g};SinaEditor.$abstract.Template.prototype={evaluate:function(data){return this.tmpl.replace(this.pattern,function(a,b,c){return data[c]||""})},evaluateMulti:function(data,reverse){var _buffer=[];var __this=this;this.__foreach(data,function(v,i){i=reverse?data.length-i:i;_buffer[i]=__this.evaluate(v)});return _buffer.join("")},__foreach:function(ar,insp){if(ar===null&&ar.constructor!==Array){return[]}var i=0,len=ar.length,r=[];while(i<len){var x=insp(ar[i],i);if(x!==null){r[r.length]=x}i++}return r}};if(!SinaEditor.$abstract){SinaEditor.$abstract={}}SinaEditor.$abstract.BaseBubbleImpl=function(styles){if(styles){SinaEditor.util.dom.addStyles(styles)}this.enbad.className=SinaEditor.CONF.bubbleClassName}.$extends(SinaEditor.$abstract.$BaseBubble).$define({showBubble:function(content,option){this.enbad.style.display='none';this.constructor.$super.showBubble.call(this,content,option);this.enbad.style.display='';return this},hiddenBubble:function(){this.constructor.$super.hiddenBubble.call(this);return this},id:function(id){return this.constructor.$super.id.call(this,id)}});SinaEditor.baseBubble=new SinaEditor.$abstract.BaseBubbleImpl(SinaEditor.CONF.bubbleStyles);(function(){var tagArr={};var inited={};SinaEditor.$abstract.BaseBubblePlugin=function(option){tagArr[option.tagName.toUpperCase()]=option.showBubble;return function(args){var editor=this;if(inited[editor.option.id]){return{'initialize':function(){},"events":[]}}else{inited[editor.option.id]=1;return{'initialize':function(){if(option.applyStyles){SinaEditor.util.dom.addStyles(option.applyStyles)}},"events":[{"element":editor.entyDoc,"events":{'mouseup':function(e){e=SinaEditor.ev.fixEvent(e);var node=e.target;if(node.nodeType==3){node=node.parentNode}while(node&&node.tagName){if(tagArr[node.tagName.toUpperCase()]){if(node.getAttribute('_se_flash')){(tagArr.FLASH)(node,editor)}else{tagArr[node.tagName.toUpperCase()](node,editor)}return}node=node.parentNode}SinaEditor.baseBubble.hiddenBubble()},'keydown':function(){SinaEditor.baseBubble.hiddenBubble()}}},{"element":editor.entyWin,"events":{'scroll':function(e){SinaEditor.baseBubble.hiddenBubble()}}},{"element":editor,"events":{'editorStateChange':function(){if(this.getState()!=SinaEditor.STATE.EDITING){SinaEditor.baseBubble.hiddenBubble()}}}}]}}}}})();if(!SinaEditor.$abstract){SinaEditor.$abstract={}}SinaEditor.$abstract.baseEditor=function(oOption){this._state=SinaEditor.STATE.CREATING;this.option=oOption||{};this.option.eventBlackList=this.option.eventBlackList||'';this._jobTable=[];this._jobTableIndex={};this.enty=null;this.entyWin=null;this.entyDoc=null;this.entyBody=null;this.entyArea=null;this.hasAddEvent=false;this.btns={};this.panels={};this._={};this.errorMsg=[];this.operation={};this.operateState={}}.$define({error:function(sMsg){console.error(sMsg);this.errorMsg.push(sMsg)},add:function(pluginConf){this._jobTable.push(pluginConf)},start:function(){if(this.option.onStart){this.option.onStart()}this.queue(this._jobTable)},queue:function(jobs,callback){var _this=this;var joblen=jobs.length;var i=0;_this.callPlugin(jobs[i]);var interNum=window.setInterval(function(){i++;if(i>=joblen){clearInterval(interNum);interNum=null;SinaEditor.ev.fire(_this,'editorOnladed');return}if(_this.entyWin){if(!_this.hasAddEvent){_this.hasAddEvent=true;var ev=null;for(ev in SinaEditor.ev.customEvent){if(_this.option.eventBlackList.indexOf(ev)<0){SinaEditor.ev.$regEvent(ev,_this)}else{console.log(_this.option.id+'Blacklisted:'+ev)}}}_this.callPlugin(jobs[i]);_this.setState(SinaEditor.STATE.CREATED);_this.setState(SinaEditor.STATE.EDITING)}else{console.log("Hold on");i--}},10)},callPlugin:function(pluginConf){var getTime=function(){return new Date().valueOf()};var plugnFuc=SinaEditor.plugins.get(pluginConf.name);if(!plugnFuc){console.log(pluginConf);console.log("---------------------------plugin not found:");return}var jobObj=plugnFuc.call(this,pluginConf.args||{})||{};console.log(this.option.id+'Adding job:'+pluginConf.name);var job=jobObj.initialize;var jEvents=jobObj.events;if(typeof jobObj=='undefined'){this.error("<b>Job["+pluginConf.name+"] is undefined!!!</b>");return}var _try=true;var _start=getTime();try{if(jEvents){var num=0;for(num=0;jEvents[num];num++){var eObj=jEvents[num];var target=eObj.element;var events=eObj.events;var ev=null;if(!target){console.error('!!!!!+'+ev+'+Binding failed...')}for(ev in events){console.log(target+'Bind'+ev);SinaEditor.ev.add(target,ev,events[ev],{'srcEditor':this})}}}if(job){job.call(this)}}catch(e){this.error("<b>Job["+pluginConf.name+"] failed!!!</b>"+e.message+"");_try=false;throw e}finally{if(_try){var _end=getTime()}}},focus:function(){this.entyWin.focus()},setState:function(state){this._state=state;SinaEditor.ev.fire(this,'editorStateChange')},getState:function(){return this._state}});SinaEditor.createEditor=function(conf){var job=new(eval('('+conf.editorName+')'))(conf);var pName=conf.plugns,i;job.add(conf.initType);if(conf.filter){job.add(conf.filter)}for(i=0;pName[i];i++){job.add(pName[i])}job.start();return job};if(!SinaEditor.plugins){SinaEditor.plugins={};SinaEditor.plugins.add=function(pluginName,func){if(!this._pluginObj){this._pluginObj={}}this._pluginObj[pluginName]=func};SinaEditor.plugins.get=function(pluginName){return this._pluginObj[pluginName]}}if(!SinaEditor.$abstract){SinaEditor.$abstract={}}SinaEditor.$abstract.BtnBubble=function(){this.isHidden=true}.$extends(SinaEditor.$abstract.$BaseBubble).$define({showBubble:function(content,option){if(option.className){this.enbad.className=option.className}this.enbad.style.display='none';this.constructor.$super.showBubble.call(this,content,option);this.enbad.style.display='';SinaEditor.ev.add(document,'mouseup',this._handleClick);this.isHidden=false;return this},hiddenBubble:function(){this.constructor.$super.hiddenBubble.call(this);SinaEditor.ev.remove(document,'mouseup',this._handleClick);this.isHidden=true;return this},_handleClick:function(e){e=SinaEditor.ev.fixEvent(e);var src=e.target;if(SinaEditor.util.dom.containsNode(SinaEditor.btnBubble.enbad,src)){return}if(!SinaEditor.btnBubble.isHidden){SinaEditor.btnBubble.hiddenBubble()}},id:function(id){return this.enbad.ownerDocument.getElementById(id)}});SinaEditor.btnBubble=new SinaEditor.$abstract.BtnBubble();if(!SinaEditor.$abstract){SinaEditor.$abstract={}}SinaEditor.$abstract.ButtonFactory=function(){this.buttonObjs={}}.$define({createButton:function(option,editor){if(!this.buttonObjs[editor.option.id]){this.buttonObjs[editor.option.id]=[]}var btn=null;switch(option.btnType||'div'){case'div':btn=new SinaEditor.$abstract.divButton(option,editor);break;case'custom':btn=new SinaEditor.$abstract.customButton(option,editor);break}if(!btn.noAppend){this._addBtn(btn,option,editor)}return btn},_addBtn:function(btn,option,editor){var groupid=editor.option.id+'_'+(option.group||'g'+(new Date().getTime()));var added=false;var groupArr=this.buttonObjs[editor.option.id],i;for(i=0;groupArr[i];i++){if(groupArr[i][groupid]){added=true;groupArr[i][groupid].push(btn)}}if(!added){var obj={};obj[groupid]=[btn];this.buttonObjs[editor.option.id].push(obj)}var me=this;if(editor.getState()<=SinaEditor.STATE.CREATED){SinaEditor.ev.add(editor,'editorOnladed',function(){var groups=me.buttonObjs[this.option.id];var group,gid,i,j;for(i=0;groups[i];i++){group=groups[i];var gSpan=SinaEditor.util.dom.createDom('div',{'properties':{'className':'se_ico_group','id':groupid}});for(id in group){for(j=0;group[id][j];j++){gSpan.appendChild(group[id][j].$)}}document.getElementById(this.option.toolBase).appendChild(gSpan)}},{once:true})}else{var group=document.getElementById(groupid)||SinaEditor.util.dom.createDom('div',{'properties':{'className':'se_ico_group','id':groupid}});group.appendChild(btn.$);document.getElementById(editor.option.toolBase).appendChild(group)}}});SinaEditor.ButtonFactory=new SinaEditor.$abstract.ButtonFactory();if(!SinaEditor.$abstract){SinaEditor.$abstract={}}SinaEditor.$abstract.customButton=function(option,editor){this.$=this.option.entyBtn;this.noAppend=true;if(!option.noEvent){this.eventInit(option,editor)}}.$extends(SinaEditor.$abstract.$BaseButton).$define({});if(!SinaEditor.$abstract){SinaEditor.$abstract={}}SinaEditor.$abstract.divButton=function(option,editor){option.attributes=option.attributes||{};option.properties=option.properties||{};if(!option.attributes.id){option.attributes.id='b_'+new Date().getTime()}if(!option.properties.innerHTML){option.properties.innerHTML='&nbsp;'}this.$=SinaEditor.util.dom.createDom('div',{attributes:option.attributes,properties:option.properties});if(option.title){this.$.title=option.title}if(!option.noEvent){this.eventInit(option,editor)}this.noAppend=false}.$extends(SinaEditor.$abstract.$BaseButton).$define({});if(!SinaEditor.$abstract){SinaEditor.$abstract={}}SinaEditor.$abstract.redoManager=function(){this.maxLan=SinaEditor.CONF.redoConf||100;this.points={};this.cache={}}.$define({addEditor:function(editor){SinaEditor.ev.remove(editor,'redoAndUndoChanged');SinaEditor.ev.$regEvent('redoAndUndoChanged',editor);this.points[editor.option.id]=0;this.cache[editor.option.id]=[{"html":editor.entyBody.innerHTML}];this.save(editor)},save:function(editor){console.log("Save:"+editor.option.id);var len=this.cache[editor.option.id].length;var i=this.points[editor.option.id];var oldHTML=this.cache[editor.option.id][i].html;var newHTML=editor.entyBody.innerHTML;var ranges=SinaEditor.range.getCurrentRanges(editor.entyWin);var bookmarks=this._converToBookMark(ranges);if(oldHTML!==newHTML){console.log("Changed, save");if((i+1)!=len){console.log("Clear history");this.cache[editor.option.id].splice(i+1,len);len=this.cache[editor.option.id].length}if(len==this.maxLan){console.log("reached ending record");this.cache[editor.option.id].shift();len--}this.cache[editor.option.id].push({"html":newHTML,"ranges":bookmarks});this.points[editor.option.id]=len}else{console.log('Update current range');this.cache[editor.option.id][i].ranges=bookmarks}this._fireEvent(editor)},redo:function(editor){console.log("Redo:"+editor.option.id);var i=this.points[editor.option.id];var len=this.cache[editor.option.id].length;if((i+1)==len){console.log("Reached redo limit");return}this.points[editor.option.id]=++i;var cache=this.cache[editor.option.id][i];var me=this;setTimeout(function(){editor.entyBody.innerHTML=cache.html;SinaEditor.range.applyRanges(editor.entyWin,me._converToRange(editor.entyDoc,cache.ranges));editor.focus();me._fireEvent(editor)},0)},undo:function(editor){console.log("--:"+editor.option.id);var i=this.points[editor.option.id];if(i<=0){console.log("--|");return}this.points[editor.option.id]=--i;var cache=this.cache[editor.option.id][i];var me=this;setTimeout(function(){editor.entyBody.innerHTML=cache.html;SinaEditor.range.applyRanges(editor.entyWin,me._converToRange(editor.entyDoc,cache.ranges));editor.focus();me._fireEvent(editor)},0)},_converToBookMark:function(ranges){var arr=[];var i;for(i=0;ranges[i];i++){var obj={};obj.startOffset=ranges[i].startOffset;obj.endOffset=ranges[i].endOffset;obj.start=this._setPath(ranges[i].startContainer);obj.end=this._setPath(ranges[i].endContainer);arr.push(obj)}return arr},_converToRange:function(doc,bookmarks){var i=0;var rangse=[];while(bookmarks[i]){var bookmark=bookmarks[i];var r=doc.createRange();console.log(this._getPath(doc.body,bookmark.start));console.log(bookmark.startOffset);r.setStart(this._getPath(doc.body,bookmark.start),bookmark.startOffset);r.setEnd(this._getPath(doc.body,bookmark.end),bookmark.endOffset);rangse.push(r);i++}return rangse},_setPath:function(element){var locArr=[];var curr=element;var parent=element.parentNode;while(parent&&parent.nodeType!==SinaEditor.NODETYPE.HTMLELEMENT){var ch=parent.childNodes;var i;for(i=0;ch[i];i++){if(ch[i]==curr){locArr.push(i);break}}curr=parent;parent=parent.parentNode}return locArr},_getPath:function(body,locArr){var element=body;var i=locArr.length-1;while(i>=0){element=element.childNodes[locArr[i]];i--}return element},_fireEvent:function(editor){var index=this.points[editor.option.id];editor._.hasRedo=index==(this.cache[editor.option.id].length-1)?false:true;editor._.hasUndo=index===0?false:true;SinaEditor.ev.fire(editor,'redoAndUndoChanged')}});SinaEditor.redoManager=new SinaEditor.$abstract.redoManager();SinaEditor.plugins.add('addContent',function(args){var editor=this;editor.operation.addNode=function(node,focus){editor.operation.save(editor);var range=SinaEditor.range.getCurrentRanges(editor.entyWin)[0];if(!range.collapsed){range.deleteContents()}range.insertNode(node);if(!focus){_focusAfter(node,range)}editor.operation.save(editor)};editor.operation.addContent=function(str,focus){editor.operation.save(editor);var range=SinaEditor.range.getCurrentRanges(editor.entyWin)[0];if(!range.collapsed){range.deleteContents()}var textNode=editor.entyDoc.createTextNode(str);range.insertNode(textNode);if(!focus){_focusAfter(textNode,range)}editor.operation.save(editor)};var _focusAfter=function(node,range){range.selectNode(node);range.collapse(false);SinaEditor.range.applyRanges(editor.entyWin,range);editor.focus()}});SinaEditor.plugins.add('backcolor',function(args){var editor=this;editor.btns.backcolor=null;editor.panels.backcolor=null;if(!args.customerPanel){editor.callPlugin({'name':'backcolorPanel','args':args})}if(!args.customerBtn){editor.callPlugin({'name':'backcolorBtn','args':args})}SinaEditor.range.regQueryCommandState('backcolor',function(refNode){return SinaEditor.util.dom.getStyle(refNode,'backgroundColor')});editor.operation.backcolor=function(color){editor.operation.save(editor);console.log('Background color changed');SinaEditor.range.applyStyle(editor,{'useTagName':'span','style':'backgroundColor','value':color});editor.btns.backcolor.setState(SinaEditor.BUTTONSTATE.NORMAL,color);editor.operation.save(editor)}});SinaEditor.plugins.add('backcolorBtn',function(args){var editor=this;var btnConf={title:'Background color',normalClass:'ico_hilitecolor_1',disabledClass:'ico_hilitecolor_4',clickedClass:'ico_hilitecolor_3',mouseoverClass:'ico_hilitecolor_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'common',setState:function(state,color){switch(state){case SinaEditor.BUTTONSTATE.DISABLED:this.$.style.backgroundColor='#FFFFFF';break;default:this.$.style.backgroundColor=color}}};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.backcolor=btn;return{"events":[{"element":btn.$,"events":{'click':function(){if(editor.btns.backcolor.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}editor.panels.backcolor.show(this);return false}}},{"element":editor,"events":{'editorSelectionChange':function(e,range,refNode){var color=SinaEditor.range.queryCommandState(this.entyDoc,'backColor');if(color==='transparent'){color='#FFFFFF'}editor.btns.backcolor.setState(SinaEditor.BUTTONSTATE.NORMAL,color)}}}]}});SinaEditor.plugins.add('backcolorPanel',function(args){var editor=this;var outerDiv=SinaEditor.util.dom.createDom('div',{properties:{'className':'se_forecolor_bubble'}});editor.panels.backcolor=(function(){var colors=args.colors||SinaEditor.TOOLCONF.COLOR;outerDiv.style.display='none';document.body.appendChild(outerDiv);var selArr=[];var color;for(color in colors){selArr.push('<span onmouseover="this.className=\'color_focus\'" onmouseout="this.className=\'\'"><span class="j_single_color" title="');selArr.push(colors[color]);selArr.push('" style="background-color:#');selArr.push(color);selArr.push(';"></span></span>')}outerDiv.innerHTML=selArr.join('');return{show:function(elm){var loc=SinaEditor.util.dom.getXY(elm);outerDiv.style.display='';outerDiv.style.top=loc[1]+editor.btns.backcolor.$.offsetHeight+'px';outerDiv.style.left=loc[0]+'px'},hidden:function(){outerDiv.style.display='none'}}})();return{"events":[{"element":editor,"events":{'editorSelectionChange':function(){editor.panels.backcolor.hidden()}}},{"element":outerDiv,"events":{'click':function(e){var target=e.target;if(target.className==='j_single_color'){editor.operation.backcolor(SinaEditor.util.dom.getStyle(target,'backgroundColor'));editor.panels.backcolor.hidden()}}}},{"element":document,"events":{'click':function(e){var target=e.target;if(SinaEditor.util.dom.containsNode(editor.btns.backcolor.$,target)){return}if(!SinaEditor.util.dom.containsNode(outerDiv,target)){editor.panels.backcolor.hidden()}}}}]}});SinaEditor.plugins.add('bold',function(args){var editor=this;if(!args.customerBtn){editor.callPlugin({'name':'boldBtn','args':args})}var btn=editor.btns.bold;editor.operation.bold=function(refNode){var ranges=SinaEditor.range.getCurrentRanges(editor.entyWin);ranges=ranges[0];if(!ranges){return}editor.operation.save(editor);var isBold=editor.operateState.bold;if(isBold){console.log('UnBold');SinaEditor.range.removeStyle(editor,{'useTagName':['strong','b']});btn.setState(SinaEditor.BUTTONSTATE.NORMAL)}else{console.log('Bold');SinaEditor.range.applyStyle(editor,{'useTagName':'strong'});btn.setState(SinaEditor.BUTTONSTATE.CLICKED)}editor.operateState.bold=!isBold;editor.operation.save(editor)};return{"events":[{"element":editor,"events":{'editorSelectionChange':function(e,range,refNode){var isBold=SinaEditor.range.queryCommandState(this.entyDoc,'bold');if(isBold){btn.setState(SinaEditor.BUTTONSTATE.CLICKED)}else{btn.setState(SinaEditor.BUTTONSTATE.NORMAL)}this.operateState.bold=isBold},'ctrlb':function(){editor.operation.bold(this)}}}]}});SinaEditor.plugins.add('boldBtn',function(args){var editor=this;var btnConf={title:'Bold',normalClass:'ico_bold_1',disabledClass:'ico_bold_4',clickedClass:'ico_bold_3',mouseoverClass:'ico_bold_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'common'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.bold=btn;return{"events":[{'element':btn.$,'events':{'click':function(){editor.operation.bold(editor)}}}]}});SinaEditor.plugins.add('faceUI',function(args){var editor=this;if(!args.customerBtn){editor.callPlugin({'name':'faceUIBtn','args':args})}if(!args.customerPanel){editor.callPlugin({'name':'faceUIPanel','args':args})}editor.operation.addFace=function(src){if(!src){return}editor.operation.save(editor);var img=SinaEditor.util.dom.createDom('img',{ownerDocument:editor.entyDoc,attributes:{'_se_type':'face'},properties:{'src':src}});editor.operation.addNode(img);editor.operation.save(editor)}});SinaEditor.plugins.add('faceUIBtn',function(args){var editor=this;var btnConf={title:'Smilies',normalClass:'ico_face_1',disabledClass:'ico_face_4',clickedClass:'ico_face_3',mouseoverClass:'ico_face_2',state:SinaEditor.BUTTONSTATE.NORMAL,group:'richdata'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.faceUI=btn;return{"events":[{"element":btn.$,"events":{'click':function(){var facePanel=editor.panels.faceUI;if(btn.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}var pos=SinaEditor.util.dom.getXY(btn.$);facePanel.setPosition({x:pos[0],y:(pos[1]+btn.$.offsetHeight)});facePanel.show()}}}]}});SinaEditor.plugins.add('faceUIPanel',function(args){var editor=this;var facePanel=new SinaEditor._.Panel();facePanel.setTemplate(SinaEditor.TOOLCONF.faceTemplate);var panel=facePanel.nodes.panel;var faceArr=args.faceSrc||SinaEditor.TOOLCONF.faceSrc;var htmls=[];var i,key;for(i=0;faceArr[i];i++){htmls.push('<img ');for(key in faceArr[i]){htmls.push(key);htmls.push('="');htmls.push(faceArr[i][key]);htmls.push('"')}htmls.push('" onmouseout="this.className=\'\'" onmouseover="this.className=\'face_focus\'" ');htmls.push('/>')}panel.innerHTML=htmls.join('');editor.panels.faceUI=facePanel;return{"events":[{"element":editor,"events":{'editorSelectionChange':function(){facePanel.hidden()}}},{"element":panel,"events":{'click':function(e){var target=e.target;if(target.tagName.toUpperCase()=='IMG'){editor.operation.addFace(target.src);facePanel.hidden()}}}},{"element":document,"events":{'click':function(e){var target=e.target;if(SinaEditor.util.dom.containsNode(editor.btns.faceUI.$,target)){return}if(!SinaEditor.util.dom.containsNode(panel,target)){facePanel.hidden()}}}}]}});SinaEditor.plugins.add('flashBubble',function(){return SinaEditor.$abstract.BaseBubblePlugin({tagName:'FLASH',applyStyles:SinaEditor.CONF.aBubbleStyles,showBubble:function(node,editor){var t=new Date().getTime();var html,data;var seid='f_se_b_'+t;var did='f_d_b_'+t;var sid='f_s_b_'+t;var cid='f_c_b_'+t;data={seeid:seid,deleteid:did,showflash:sid,closeid:cid};var href=node.href;html=new SinaEditor.$abstract.Template(SinaEditor.CONF.flashBubbleTemplete);var pos=SinaEditor.util.dom.getXY(node,true);var iframePos=SinaEditor.util.dom.getXY(editor.enty);if(iframePos[1]>pos[1]){pos[1]=iframePos[1]}var bubble=SinaEditor.baseBubble.showBubble(html.evaluate(data),{x:pos[0],y:pos[1]});bubble.id(seid).onclick=function(){var snode=bubble.id(sid);bubble.id(seid).style.display='none';snode.innerHTML=decodeURIComponent(node.getAttribute('_se_flash'));if(SinaEditor.env.$CHROME){var embed=snode.getElementsByTagName('embed')[0];embed.setAttribute('wmode','transparent');snode.innerHTML=SinaEditor.util.dom.outerHTML(embed)}snode.style.display=''};bubble.id(cid).onclick=function(){SinaEditor.baseBubble.hiddenBubble();editor.focus()};bubble.id(did).onclick=function(){editor.operation.save(editor);var children=node;SinaEditor.range.setStartBefore(editor.entyWin,node);node.parentNode.removeChild(node);SinaEditor.baseBubble.hiddenBubble();editor.focus();editor.operation.save(editor)}}})}());SinaEditor.plugins.add('flashUI',function(args){var editor=this;if(!args.customerBtn){editor.callPlugin({'name':'flashUIBtn','args':args})}if(!args.customerPanel){editor.callPlugin({'name':'flashUIPanel','args':args})}editor.operation.insertFlash=function(node,focus){if(typeof node==='string'){node=SinaEditor.util.dom.createDomFromHTML(node,editor.entyDoc)}var img=SinaEditor.util.dom.createDomFromHTML('<img src="'+SinaEditor.CONF.transparentIMG+'" _se_flash="'+encodeURIComponent(SinaEditor.util.dom.outerHTML(node))+'" width="'+(node.width||480)+'" height="'+(node.height||370)+'" style="background:url(\''+SinaEditor.CONF.fakeFLASH+'\') no-repeat scroll center center transparent;border:1px solid #A9A9A9;" >',editor.entyDoc);editor.operation.addNode(img,focus)}});SinaEditor.plugins.add('flashUIBtn',function(args){var editor=this;var btnConf={title:'Insert flash',normalClass:'ico_video_1',disabledClass:'ico_video_4',clickedClass:'ico_video_3',mouseoverClass:'ico_video_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'richdata'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.flashUI=btn;return{"events":[{"element":btn.$,"events":{'click':function(){if(btn.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}editor.panels.flashUI.show();return false}}}]}});SinaEditor.plugins.add('flashUIPanel',function(args){var editor=this;var flashPanel=SinaEditor.winDialog.create({title:'Adding flash',content:SinaEditor.TOOLCONF.flashTemplate,funcClose:function(){_back()}});var flashSrc=flashPanel.nodes.flashSrc;var ok=flashPanel.nodes.ok;var cancel=flashPanel.nodes.cancel;var flashErrTip=flashPanel.nodes.flashErrTip;var _back=function(){flashSrc.value='';flashErrTip.style.display='none'};editor.panels.flashUI=flashPanel;return{"events":[{"element":cancel,"events":{'click':function(){_back();flashPanel.hidden()}}},{"element":ok,"events":{'click':function(){flashErrTip.style.display='none';var src=SinaEditor.util.trim(flashSrc.value);if(!src){flashErrTip.style.display='';return}editor.operation.insertFlash(src);_back();flashPanel.hidden()}}}]}});SinaEditor.plugins.add('fontSize',function(args){var editor=this;SinaEditor.range.regQueryCommandState('fontsize',function(refNode){return SinaEditor.util.dom.getStyle(refNode,'fontSize')});if(!args.customerBtn){editor.callPlugin({'name':'fontSizeBtn','args':args})}if(!args.customerBtn){editor.callPlugin({'name':'fontSizePanel','args':args})}var btn=editor.btns.fontSize;editor.operation.setFontSize=function(fontSize){editor.operation.save(editor);SinaEditor.range.applyStyle(editor,{'useTagName':'span','style':'fontSize','value':fontSize});editor.operation.save(editor)}});SinaEditor.plugins.add('fontSizeBtn',function(args){var editor=this;var btnConf={title:'Font size',normalClass:'ico_fontsize_1',properties:{'innerHTML':'<span>'+SinaEditor.TOOLCONF.FONTSIZEDEF+'</span>'},disabledClass:'ico_fontsize_4',clickedClass:'ico_fontsize_3',mouseoverClass:'ico_fontsize_2',state:SinaEditor.BUTTONSTATE.NORMAL,group:'common'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.fontSize=btn});SinaEditor.plugins.add('fontSizePanel',function(args){var editor=this;var btn=editor.btns.fontSize;var _fontSizeConf=args.conf||SinaEditor.TOOLCONF.FONTSIZECONF;var _createDomHTML=function(eid){var sizes=_fontSizeConf;var str=['<div class="fontItemTitle">Font size</div>'];var size,style,i;for(i=0;sizes[i];i++){size=sizes[i].html;style=sizes[i].style||size;str.push('<div class="fontItem" style="font-size:');str.push(style);str.push('">');str.push(size);str.push('</div>')}return str.join('')};var _bindEvent=function(children){var i,cn;for(i=0;children[i];i++){cn=children[i].className;if(cn&&cn=='fontItem'){children[i].onclick=function(e){e=e||window.event;var target=SinaEditor.ev.fixEvent(e).target;var family=target.style.fontSize;btn.$.innerHTML='<span>'+target.innerHTML+'</span>';editor.operation.setFontSize(family);SinaEditor.btnBubble.hiddenBubble();return false}}}};return{"events":[{"element":editor,"events":{'editorSelectionChange':function(){SinaEditor.btnBubble.hiddenBubble()},'editorSelectionChange':function(e,range,refNode){var style=SinaEditor.range.queryCommandState(this.entyDoc,'fontsize');var family=_fontSizeConf;console.log(style);var html='<span>'+SinaEditor.TOOLCONF.FONTSIZEDEF+'</span>';var tmp,i;for(i=0;family[i];i++){tmp=family[i].style||family[i].html;if(style.indexOf(tmp)!=-1){html='<span>'+family[i].html+'</span>';break}}btn.$.innerHTML=html}}},{'element':btn.$,'events':{'click':function(){if(editor.getState()!=SinaEditor.STATE.EDITING){return}var loc=SinaEditor.util.dom.getXY(btn.$);var div=SinaEditor.util.dom.createDom('div');div.innerHTML=_createDomHTML(editor.option.id);_bindEvent(div.childNodes);SinaEditor.btnBubble.showBubble(div,{x:loc[0],y:loc[1]+btn.$.offsetHeight+SinaEditor.util.dom.styleInteger(btn.$,'paddingTop')+SinaEditor.util.dom.styleInteger(btn.$,'marginTop'),'className':'se_fontfamily_bubble'});return false}}}]}});SinaEditor.plugins.add('fontFamily',function(args){var editor=this;var btn=null;if(!SinaEditor._fontConf){SinaEditor._fontConf={}}if(!args.customerBtn){editor.callPlugin({'name':'fontFamilyBtn','args':args})}if(!args.customerPanel){editor.callPlugin({'name':'fontFamilyPanel','args':args})}editor.operation.setFontFamily=function(fontFamily){editor.operation.save(editor);SinaEditor.range.applyStyle(editor,{'useTagName':'span','style':'fontFamily','value':fontFamily});editor.operation.save(editor)}});SinaEditor.plugins.add('fontFamilyBtn',function(args){var editor=this;var _fontConf=args.conf||SinaEditor.TOOLCONF.FONTFAMILYCONF;var btnConf={title:'Font',normalClass:'ico_family_1',properties:{'innerHTML':'<span>'+SinaEditor.TOOLCONF.FONTFAMILYDEF+'</span>'},disabledClass:'ico_family_4',clickedClass:'ico_family_3',mouseoverClass:'ico_family_2',state:SinaEditor.BUTTONSTATE.NORMAL,group:'common'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.fontFamily=btn;var _createDomHTML=function(eid){var str=['<div class="fontItemTitle">Font</div>'];var family,style,i;for(i=0;_fontConf[i];i++){family=_fontConf[i].html;style=_fontConf[i].style||family;str.push('<div class="fontItem" style="font-family:');str.push(style);str.push('">');str.push(family);str.push('</div>')}return str.join('')};var _bindEvent=function(children){var i;for(i=0;children[i];i++){var cn=children[i].className;if(cn&&cn=='fontItem'){children[i].onclick=function(e){e=e||window.event;var target=SinaEditor.ev.fixEvent(e).target;var family=target.style.fontFamily;btn.$.innerHTML='<span style="font-family:'+family+'">'+target.innerHTML+'</span>';editor.operation.setFontFamily(family);SinaEditor.btnBubble.hiddenBubble();return false}}}};return{'events':[{'element':btn.$,'events':{'click':function(){if(editor.getState()!=SinaEditor.STATE.EDITING){return}var loc=SinaEditor.util.dom.getXY(btn.$);var div=SinaEditor.util.dom.createDom('div');div.innerHTML=_createDomHTML(editor.option.id);_bindEvent(div.childNodes);SinaEditor.btnBubble.showBubble(div,{x:loc[0],y:loc[1]+btn.$.offsetHeight+SinaEditor.util.dom.styleInteger(btn.$,'paddingTop')+SinaEditor.util.dom.styleInteger(btn.$,'marginTop'),'className':'se_fontfamily_bubble'});return false}}},{'element':editor,'events':{'editorSelectionChange':function(e,range,refNode){var style=SinaEditor.util.dom.getStyle(refNode,'fontFamily');var family=_fontConf;var html='<span>'+SinaEditor.TOOLCONF.FONTFAMILYDEF+'</span>';var tmp,i;for(i=0;family[i];i++){tmp=family[i].style||family[i].html;if(style.indexOf(tmp)!=-1){html='<span style="font-family:'+tmp+'">'+family[i].html+'</span>';break}}btn.$.innerHTML=html}}}]}});SinaEditor.plugins.add('fontFamilyPanel',function(args){var editor=this;var btn=editor.btns.fontFamily;var _fontConf=args.fontConf||SinaEditor.TOOLCONF.FONTFAMILYCONF;var _bindEvent=function(children){var i;for(i=0;children[i];i++){var cn=children[i].className;if(cn&&cn=='fontItem'){children[i].onclick=function(e){e=e||window.event;var target=SinaEditor.ev.fixEvent(e).target;var family=target.style.fontFamily;btn.$.innerHTML='<span style="font-family:'+family+'">'+target.innerHTML+'</span>';editor.operation.setFontFamily(family);SinaEditor.btnBubble.hiddenBubble();return false}}}};return{'events':[{"element":editor,"events":{'editorSelectionChange':function(){SinaEditor.btnBubble.hiddenBubble()}}}]}});SinaEditor.plugins.add('forecolor',function(args){var editor=this;if(!args.customerPanel){editor.callPlugin({'name':'forecolorPanel','args':args})}if(!args.customerBtn){editor.callPlugin({'name':'forecolorBtn','args':args})}var btn=editor.btns.forecolor;var panel=editor.panels.forecolor;SinaEditor.range.regQueryCommandState('forecolor',function(refNode){console.log(SinaEditor.util.dom.getStyle(refNode,'color')||'#CCC');return SinaEditor.util.dom.getStyle(refNode,'color')});editor.operation.forecolor=function(color){editor.operation.save(editor);console.log('Text color changed');SinaEditor.range.applyStyle(editor,{'useTagName':'span','style':'color','value':color});btn.setState(SinaEditor.BUTTONSTATE.NORMAL,color);editor.operation.save(editor)}});SinaEditor.plugins.add('forecolorBtn',function(args){var editor=this;var btnConf={title:'Text color',normalClass:'ico_forecolor_1',disabledClass:'ico_forecolor_4',clickedClass:'ico_forecolor_3',mouseoverClass:'ico_forecolor_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'common',setState:function(state,color){switch(state){case SinaEditor.BUTTONSTATE.DISABLED:this.$.style.backgroundColor='#000000';break;default:this.$.style.backgroundColor=color}}};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.forecolor=btn;return{"events":[{"element":editor,"events":{'editorSelectionChange':function(e,range,refNode){var color=SinaEditor.range.queryCommandState(this.entyDoc,'forecolor');if(!color){color='#000000'}btn.setState(SinaEditor.BUTTONSTATE.NORMAL,color)}}},{"element":btn.$,"events":{'click':function(e,range,refNode){if(editor.btns.backcolor.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}editor.panels.forecolor.show(this);return false}}}]}});SinaEditor.plugins.add('forecolorPanel',function(args){var editor=this;var outerDiv=SinaEditor.util.dom.createDom('div',{properties:{'className':'se_forecolor_bubble'}});var colorPanel=(function(){var colors=args.colors||SinaEditor.TOOLCONF.COLOR;outerDiv.style.display='none';document.body.appendChild(outerDiv);var selArr=[];var color;for(color in colors){selArr.push('<span onmouseover="this.className=\'color_focus\'" onmouseout="this.className=\'\'"><span class="j_single_color" title="');selArr.push(colors[color]);selArr.push('" style="background-color:#');selArr.push(color);selArr.push(';"></span></span>')}outerDiv.innerHTML=selArr.join('');return{show:function(elm){var loc=SinaEditor.util.dom.getXY(elm);outerDiv.style.display='';outerDiv.style.top=loc[1]+editor.btns.forecolor.$.offsetHeight+'px';outerDiv.style.left=loc[0]+'px'},hidden:function(){outerDiv.style.display='none'}}})();editor.panels.forecolor=colorPanel;return{'events':[{"element":outerDiv,"events":{'click':function(e){var target=e.target;if(target.className==='j_single_color'){editor.operation.forecolor(SinaEditor.util.dom.getStyle(target,'backgroundColor'));colorPanel.hidden()}}}},{"element":document,"events":{'click':function(e){var target=e.target;if(SinaEditor.util.dom.containsNode(editor.btns.forecolor.$,target)){return}if(!SinaEditor.util.dom.containsNode(outerDiv,target)){colorPanel.hidden()}}}},{"element":editor,"events":{'editorSelectionChange':function(e){colorPanel.hidden()}}}]}});SinaEditor.plugins.add('historyUI',function(args){var editor=this;var oldData='';if(!args.customerBtn){editor.callPlugin({'name':'historyUIBtn','args':args})}if(!args.customerPanel){editor.callPlugin({'name':'historyUIPanel','args':args})}var sid=args.id||0;var storage=SinaEditor.$abstract.Storage;editor.operation.saveData=function(){var newData=editor.entyBody.innerHTML;if(oldData===newData){return false}var datas=storage.getItem('SinaEditorData'+sid)||[];var keyTime=+new Date();datas.unshift(keyTime);if(datas.length>SinaEditor.TOOLCONF.historyMax){var tmpArr=datas.splice(0,SinaEditor.TOOLCONF.historyMax);var i;for(i=0;datas[i];i++){storage.removeItem('data_'+sid+'_'+datas[i])}datas=tmpArr}if(storage.setItem('data_'+sid+'_'+keyTime,encodeURIComponent(newData))&&storage.setItem('SinaEditorData'+sid,datas)){oldData=newData;editor.panels.historyUI.updataData();return true}else{storage.removeItem('data_'+sid+'_'+datas[0]);datas.shift();storage.setItem('SinaEditorData'+sid,datas);return false}};editor.operation.loadData=function(time){if(!time){return storage.getItem('SinaEditorData'+sid)}return decodeURIComponent(storage.getItem('data_'+sid+'_'+time))};editor.operation.putData=function(time){var data=this.loadData(time);if(!data){return}if(data.join){data=this.loadData(data[0])}editor.entyBody.innerHTML=data;editor.operation.clearRU()};var save=function(){};var clear=function(){};if(!args.closeAutoSave){var histroyKey;save=function(){histroyKey=setInterval(function(){editor.operation.saveData()},600000)};clear=function(){clearInterval(histroyKey)}}return{"events":[{"element":editor,"events":{'editorStateChange':function(){switch(this.getState()){case SinaEditor.STATE.CREATED:editor.panels.historyUI.updataData();editor.operation.putData(0);save();break;case SinaEditor.STATE.EDITING:clearInterval(histroyKey);save();break;case SinaEditor.STATE.SHOWSOURCE:clear();break}},'ctrls':function(){editor.operation.saveData()}}}]}});SinaEditor.plugins.add('historyUIBtn',function(args){var editor=this;var btnConf={title:'Revisions',normalClass:'ico_quicksave_1',disabledClass:'ico_quicksave_4',clickedClass:'ico_quicksave_3',mouseoverClass:'ico_quicksave_2',state:SinaEditor.BUTTONSTATE.NORMAL,group:'richdata'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.historyUI=btn;return{"events":[{"element":btn.$,"events":{'click':function(){if(btn.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}var historyPanel=editor.panels.historyUI;var pos=SinaEditor.util.dom.getXY(btn.$);historyPanel.setPosition({x:pos[0],y:(pos[1]+btn.$.offsetHeight)});historyPanel.show()}}}]}});SinaEditor.plugins.add('historyUIPanel',function(args){var editor=this;var btn=null;var sid=args.id||0;var storage=SinaEditor.$abstract.Storage;var historyPanel=new SinaEditor._.Panel();historyPanel.setTemplate(SinaEditor.TOOLCONF.historyTemplate);var panel=historyPanel.nodes.panel;var _addZero=function(data){return data<10?'0'+data:data};editor.panels.historyUI=historyPanel;editor.panels.historyUI.updataData=function(){var datas=editor.operation.loadData()||[];if(!datas.length){return}var htmls=[];var d,i;for(i=0;datas[i];i++){d=new Date(datas[i]);htmls.push('<div time="');htmls.push(datas[i]);htmls.push('" >');htmls.push(d.getFullYear());htmls.push('-');htmls.push(_addZero(d.getMonth()+1));htmls.push('-');htmls.push(_addZero(d.getDate()));htmls.push('&nbsp;');htmls.push(_addZero(d.getHours()));htmls.push(':');htmls.push(_addZero(d.getMinutes()));htmls.push(':');htmls.push(_addZero(d.getSeconds()));htmls.push('</div>')}panel.innerHTML=htmls.join('')};return{"events":[{"element":editor,"events":{'editorSelectionChange':function(){historyPanel.hidden()}}},{"element":panel,"events":{'click':function(e){var target=e.target;var time=target.getAttribute('time');if(target.tagName.toUpperCase()=='DIV'&&time){editor.operation.putData(time);historyPanel.hidden()}}}},{"element":document,"events":{'click':function(e){var btn=editor.btns.historyUI;var target=e.target;if(target===btn.$){return}if(!SinaEditor.util.dom.containsNode(panel,target)){historyPanel.hidden()}}}}]}});SinaEditor.plugins.add('imgBubble',function(){return SinaEditor.$abstract.BaseBubblePlugin({tagName:'IMG',applyStyles:SinaEditor.CONF.aBubbleStyles,showBubble:function(node,editor){if(node.getAttribute('_se_type')){return}var t=new Date().getTime();var html,data;var mid='i_m_b_'+t;var did='i_d_b_'+t;data={modifyid:mid,deleteid:did};var href=node.href;html=new SinaEditor.$abstract.Template(SinaEditor.CONF.imgBubbleTemplete);var pos=SinaEditor.util.dom.getXY(node,true);var iframePos=SinaEditor.util.dom.getXY(editor.enty,true);if(iframePos[1]>pos[1]){pos[1]=iframePos[1]}var bubble=SinaEditor.baseBubble.showBubble(html.evaluate(data),{x:pos[0],y:pos[1]});if(!SinaEditor.CONF.imgBubbleModify){bubble.id(mid).style.display='none'}else{bubble.id(mid).onclick=function(){if(!SinaEditor.CONF.imgBubbleModify(node)){SinaEditor.baseBubble.hiddenBubble()}return false}}if(!SinaEditor.CONF.imgBubbleDelete){bubble.id(did).style.display='none'}else{bubble.id(did).onclick=function(){if(!SinaEditor.CONF.imgBubbleDelete(node)){SinaEditor.baseBubble.hiddenBubble()}return false}}}})}());SinaEditor.plugins.add('imgUI',function(args){var editor=this;if(!args.customerBtn){editor.callPlugin({'name':'imgUIBtn','args':args})}if(!args.customerPanel){editor.callPlugin({'name':'imgUIPanel','args':args})}if(!SinaEditor.CONF.imgBubbleModify){SinaEditor.CONF.imgBubbleModify=function(node){var panel=editor.panels.imgUI;panel.fromBubble=true;panel.tmpNode=node;editor.panels.imgUI.show()}}if(!SinaEditor.CONF.imgBubbleDelete){SinaEditor.CONF.imgBubbleDelete=function(node){editor.operation.save(editor);node.parentNode.removeChild(node);editor.operation.save(editor);editor.focus()}}});SinaEditor.plugins.add('imgUIBtn',function(args){var editor=this;var btnConf={title:'Insert image',normalClass:'ico_img_1',disabledClass:'ico_img_4',clickedClass:'ico_img_3',mouseoverClass:'ico_img_2',state:SinaEditor.BUTTONSTATE.NORMAL,group:'richdata'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.imgUI=btn;return{'events':[{"element":btn.$,"events":{'click':function(){if(btn.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}editor.panels.imgUI.show();return false}}}]}});SinaEditor.plugins.add('imgUIPanel',function(args){var editor=this;var MAX_HEIGHT=442;var MAX_WIDTH=630;var imgPanel=SinaEditor.winDialog.create({title:'Insert image',content:SinaEditor.TOOLCONF.imgTemplate,funcClose:function(){if(showMy){_backMy()}else{_backWeb()}}});var useClient=imgPanel.nodes.useClient;var clientView=imgPanel.nodes.clientView;var clientFile=imgPanel.nodes.clientFile;var contentLoading=imgPanel.nodes.contentLoading;var cancleClient=imgPanel.nodes.cancleClient;var resultPic=imgPanel.nodes.resultPic;var addClientPic=imgPanel.nodes.addClientPic;var webContent=imgPanel.nodes.webContent;var webUrl=imgPanel.nodes.webUrl;var clientResult=imgPanel.nodes.clientResult;var errTips=imgPanel.nodes.errTips;var clientIframe=imgPanel.nodes.clientIframe;var resetClient=imgPanel.nodes.resetClient;var clientUploadDiv=imgPanel.nodes.clientUploadDiv;var clientMoreUp=imgPanel.nodes.clientMoreUp;var clientForm=imgPanel.nodes.clientForm;var tabMy=imgPanel.nodes.tabMy;var tabWeb=imgPanel.nodes.tabWeb;var webAdd=imgPanel.nodes.webAdd;var webPic=imgPanel.nodes.webPic;var webPicContainer=webPic.parentNode;var webPicLoading=imgPanel.nodes.webPicLoading;var clientFileDrag=imgPanel.nodes.clientFileDrag;var showMy=true;var _defaultUrlVal='http://';var _inputInterval=null;var _oldVal=_defaultUrlVal;imgPanel.fromBubble=false;imgPanel.tmpNode=null;var switchTab=function(isMy){if(showMy===!!isMy){return}if(isMy){_backMy(true);tabMy.className='cur';webContent.style.display='none';tabWeb.className='';useClient.style.display=''}else{_backWeb(true);tabMy.className='';useClient.style.display='none';tabWeb.className='cur';webContent.style.display=''}showMy=!showMy};var _showClient=function(elm){contentLoading.style.display='none';clientView.style.display='none';clientResult.style.display='none';elm.style.display=''};var _errLogic={showErr:function(str,time){errTips.innerHTML=str;errTips.style.display='';if(time){var me=this;setTimeout(function(){me.hiddenErr()},time*1000)}},hiddenErr:function(){errTips.style.display='none'}};var resizeIMG=function(img){if(!img.src){return}img.removeAttribute('width');img.removeAttribute('height');var width=img.width;var height=img.height;if(width<MAX_WIDTH&&height<MAX_HEIGHT){return}if(MAX_WIDTH/MAX_HEIGHT<width/height){img.width=MAX_WIDTH}else{img.height=MAX_HEIGHT}};var _backMy=function(noRest){_showClient(clientView);_errLogic.hiddenErr();if(!noRest){imgPanel.fromBubble=false;imgPanel.tmpNode=null}resultPic.src=''};var _backWeb=function(noRest){_oldVal=_defaultUrlVal;webUrl.value=_defaultUrlVal;webAdd.style.display='none';webPicContainer.style.display='none';webPicLoading.style.display='none';_errLogic.hiddenErr();if(!noRest){imgPanel.fromBubble=false;imgPanel.tmpNode=null}webAdd.src=''};var _isImg=function(type){type=type||'';if(!SinaEditor.TOOLCONF.imgType.test(type)){_errLogic.showErr(SinaEditor.TOOLCONF.imgErrTypeMSG,3);return false}return true};SinaEditor.ev.add(clientUploadDiv,'dragenter',function(e){clientMoreUp.style.display='';clientUploadDiv.style.borderStyle='dashed'});SinaEditor.ev.add(clientUploadDiv,'dragover',function(e){SinaEditor.ev.stopEvent(e)});SinaEditor.ev.add(clientUploadDiv,'drop',function(e){SinaEditor.ev.stopEvent(e);clientUploadDiv.style.borderStyle='solid';clientMoreUp.style.display='none';var file=e.dataTransfer.files;if(file.length){file=file[0]}if(!_isImg(file.name)){return}var reader=new FileReader();reader.onload=function(e){clientFileDrag.value=e.target.result;clientForm.submit();_showClient(contentLoading);clientFileDrag.value=''};reader.readAsDataURL(file)});SinaEditor.ev.add(clientUploadDiv,'dragleave',function(e){clientUploadDiv.style.borderStyle='solid';clientMoreUp.style.display='none'});editor.panels.imgUI=imgPanel;return{"events":[{"element":webUrl,"events":{'focus':function(){_inputInterval=setInterval(function(){var newVal=webUrl.value;if(newVal!=_oldVal){_oldVal=newVal;webPicContainer.style.display='none';webPicLoading.style.display='';var img=new Image();img.onload=function(){webPic.src=img.src;setTimeout(function(){resizeIMG(webPic);_errLogic.hiddenErr();webPicLoading.style.display='none';webPicContainer.style.display='';webAdd.style.display=''},1)};img.onerror=function(){webAdd.style.display='none';_errLogic.showErr('Invalid image url, please try again.');webPicContainer.style.display='none';webPicLoading.style.display='none'};img.src=webUrl.value}},1000)},'blur':function(){clearInterval(_inputInterval)}}},{"element":tabMy,"events":{'click':function(){switchTab(true)}}},{"element":tabWeb,"events":{'click':function(){switchTab(false)}}},{"element":addClientPic,"events":{'click':function(){if(imgPanel.fromBubble){imgPanel.tmpNode.src=resultPic.src;imgPanel.hidden();_backMy();return}var img=SinaEditor.util.dom.createDom('img',{'ownerDocument':editor.entyDoc,properties:{src:resultPic.src}});editor.operation.addNode(img,true);imgPanel.hidden();_backMy()}}},{"element":webAdd,"events":{'click':function(){if(imgPanel.fromBubble){imgPanel.tmpNode.src=webPic.src;imgPanel.hidden();_backWeb();return}var img=SinaEditor.util.dom.createDom('img',{ownerDocument:editor.entyDoc,properties:{src:webPic.src}});editor.operation.addNode(img,true);imgPanel.hidden();_backWeb()}}},{"element":resetClient,"events":{'click':function(){resultPic.src='';_showClient(clientView)}}},{"element":clientUploadDiv,"events":{'mousemove':function(e){var pos=SinaEditor.util.dom.getXY(clientUploadDiv);var scroll=SinaEditor.util.dom.getScrollPos();clientFile.style.left=(e.clientX-pos[0]-10+scroll[1])+'px';clientFile.style.top=(e.clientY-pos[1]-15+scroll[0])+'px'}}},{"element":cancleClient,"events":{'click':function(){clientIframe.src='';_showClient(clientView)}}},{"element":clientIframe,"events":{'load':function(){console.log('.......client loadedï¼ï¼ï¼');try{var val=clientIframe.contentWindow.document.body.innerHTML;if(!val){console.log('false positive');return}_showClient(clientResult);clientIframe.contentWindow.document.body.innerHTML='';var img=new Image();img.onload=function(){resultPic.src=val;setTimeout(function(){resizeIMG(resultPic)},1)};img.src=val}catch(e){}}}},{"element":clientFile,"events":{'change':function(){if(!_isImg(clientFile.value)){return}clientForm.submit();_showClient(contentLoading)}}}]}});SinaEditor.plugins.add('indent',function(args){var editor=this;if(!args.customerBtn){editor.callPlugin({'name':'indentBtn','args':args})}editor.operation.indent=function(){editor.focus();editor.operation.save(editor);editor.entyDoc.execCommand("indent",false,'');editor.operation.save(editor);editor.focus()}});SinaEditor.plugins.add('indentBtn',function(args){var editor=this;var btnConf={title:'Increase indent',normalClass:'ico_indent_1',disabledClass:'ico_indent_4',clickedClass:'ico_indent_3',mouseoverClass:'ico_indent_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'composing'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.indent=btn;return{'initialize':function(){},"events":[{"element":btn.$,"events":{'click':function(){if(btn.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}editor.operation.indent();return false}}}]}});SinaEditor.plugins.add('initFromStatic',function(args){var editor=this;function init(){editor.entyWin=editor.enty.contentWindow;editor.entyDoc=editor.entyWin.document;editor.entyBody=editor.entyDoc.body;editor.entyBody.spellcheck=!!editor.option.disableNativeSpellChecker;if(SinaEditor.env.$IE){editor.entyBody.hideFocus=true;editor.entyBody.disabled=true;editor.entyBody.contentEditable=true;editor.entyBody.removeAttribute('disabled')}else{setTimeout(function(){if(SinaEditor.env.$GENKO){editor.entyBody.contentEditable=true;var fFocus=false;SinaEditor.ev.add(editor.enty,'DOMAttrModified',function(e){var an=e.attrName.toUpperCase();if(an=='CLASS'||an=='STYLE'){editor.entyBody.contentEditable=false;editor.entyBody.contentEditable=true;editor.entyWin.blur();editor.entyWin.focus()}})}else if(SinaEditor.env.$WEBKIT){editor.entyBody.parentNode.contentEditable=true}else{editor.entyDoc.designMode='on'}},0)}setTimeout(function(){try{editor.entyDoc.execCommand('enableObjectResizing',false,!editor.option.disableObjectResizing)}catch(e){}try{editor.entyDoc.execCommand('enableInlineTableEditing',false,!editor.option.disableNativeTableHandles)}catch(e){}if(SinaEditor.env.$IE){setTimeout(function(){var doc=editor.entyDoc;if(doc){var $body=doc.body;$body.runtimeStyle.marginBottom='0px';$body.runtimeStyle.marginBottom=''}},1000)}},0);if(SinaEditor.env.$IE){var sc=SinaEditor.util.dom.createDom('script',{'ownerDocument':editor.entyDoc,'attributes':{'type':'text/javascript','src':'http://test.sina.com.cn/editor/ierange-m2.js'}});editor.entyDoc.getElementsByTagName('head')[0].appendChild(sc)}if(editor.option.styleLinks){var links=editor.option.styleLinks;var i;for(i=0;links[i];i++){SinaEditor.util.dom.addLink(links[i],editor.entyDoc)}}if(editor.option.styles){SinaEditor.util.dom.addStyles(editor.option.styles,editor.entyDoc)}}var func='document.open();'+(SinaEditor.env.isCustomDomain?'document.domian="'+document.domain+'";':'')+'document.close();';var iframe=SinaEditor.util.dom.createDomFromHTML('<iframe'+' style="width:100%;height:100%;z-index:999;"'+' frameBorder="0"'+' src="'+(SinaEditor.env.$IE?'javascript:void(function(){'+encodeURIComponent(func)+'}())':'')+'"'+' allowTransparency="true"'+'></iframe>');editor.enty=iframe;SinaEditor.ev.add(iframe,'load',init);args.parent.appendChild(iframe)});SinaEditor.plugins.add('italic',function(args){var editor=this;if(!args.customerBtn){editor.callPlugin({'name':'italicBtn','args':args})}var btn=editor.btns.italic;editor.operation.italic=function(){var ranges=SinaEditor.range.getCurrentRanges(editor.entyWin);ranges=ranges[0];if(!ranges){return}var text=ranges.toString();editor.operation.save(editor);var isItalic=editor.operateState.italic;if(isItalic){console.log('UnItalic');SinaEditor.range.removeStyle(editor,{'useTagName':['i','em']});SinaEditor.range.removeStyle(editor,{'useTagName':'span','style':'fontStyle'});btn.setState(SinaEditor.BUTTONSTATE.NORMAL)}else{console.log('Italic');SinaEditor.range.applyStyle(editor,{'useTagName':'em'});btn.setState(SinaEditor.BUTTONSTATE.CLICKED)}editor.operateState.italic=!isItalic;editor.operation.save(editor)};return{"events":[{"element":editor,"events":{'editorSelectionChange':function(e,range,refNode){var isItalic=SinaEditor.range.queryCommandState(this.entyDoc,'italic');if(isItalic){btn.setState(SinaEditor.BUTTONSTATE.CLICKED)}else{btn.setState(SinaEditor.BUTTONSTATE.NORMAL)}this.operateState.italic=isItalic},'ctrli':function(){editor.operation.italic(this)}}}]}});SinaEditor.plugins.add('italicBtn',function(args){var editor=this;var btnConf={title:'Italic',normalClass:'ico_italic_1',disabledClass:'ico_italic_4',clickedClass:'ico_italic_3',mouseoverClass:'ico_italic_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'common'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.italic=btn;return{"events":[{'element':btn.$,'events':{'click':function(){if(editor.btns.italic.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}editor.operation.italic();return false}}}]}});SinaEditor.plugins.add('justifycenter',function(args){var editor=this;if(!args.customerBtn){editor.callPlugin({'name':'justifycenterBtn','args':args})}editor.operation.justifycenter=function(){editor.operation.save(editor);editor.entyDoc.execCommand("Justifycenter",'','');editor.operation.save(editor)}});SinaEditor.plugins.add('justifycenterBtn',function(args){var editor=this;var btnConf={title:'Center',normalClass:'ico_justifycenter_1',disabledClass:'ico_justifycenter_4',clickedClass:'ico_justifycenter_3',mouseoverClass:'ico_justifycenter_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'composing'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.justifycenter=btn;return{'initialize':function(){},"events":[{"element":btn.$,"events":{'click':function(){if(btn.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}editor.operation.justifycenter();return false}}}]}});SinaEditor.plugins.add('justifyleft',function(args){var editor=this;if(!args.customerBtn){editor.callPlugin({'name':'justifyleftBtn','args':args})}editor.operation.justifyleft=function(){editor.operation.save(editor);editor.entyDoc.execCommand("Justifyleft",'','');editor.operation.save(editor)}});SinaEditor.plugins.add('justifyleftBtn',function(args){var editor=this;var btnConf={title:'Left',normalClass:'ico_justifyleft_1',disabledClass:'ico_justifyleft_4',clickedClass:'ico_justifyleft_3',mouseoverClass:'ico_justifyleft_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'composing'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.justifyleft=btn;return{'initialize':function(){},"events":[{"element":btn.$,"events":{'click':function(){if(btn.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}editor.operation.justifyleft();return false}}}]}});SinaEditor.plugins.add('justifyright',function(args){var editor=this;var btn=null;if(!args.customerBtn){editor.callPlugin({'name':'justifyrightBtn','args':args})}editor.operation.justifyright=function(){editor.operation.save(editor);editor.entyDoc.execCommand("justifyright",'','');editor.operation.save(editor)}});SinaEditor.plugins.add('justifyrightBtn',function(args){var editor=this;var btnConf={title:'Right',normalClass:'ico_justifyright_1',disabledClass:'ico_justifyright_4',clickedClass:'ico_justifyright_3',mouseoverClass:'ico_justifyright_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'composing'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.justifyright=btn;return{"events":[{"element":btn.$,"events":{'click':function(){if(btn.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}editor.operation.justifyright();return false}}}]}});(function(){SinaEditor.plugins.add('linkBubble',SinaEditor.$abstract.BaseBubblePlugin({tagName:'A',applyStyles:SinaEditor.CONF.aBubbleStyles,showBubble:function(node,editor){var href=node.href;if(!href){return}var t=new Date().getTime();var html,data;var mid='a_m_b_'+t;var did='a_d_b_'+t;data={modifyid:mid,deleteid:did};var mailTo=href.match(/^mailto:(.*$)/i);if(mailTo){html=new SinaEditor.$abstract.Template(SinaEditor.CONF.mailBubbleTemplete);data.srcstr=subStr(mailTo[1])}else{html=new SinaEditor.$abstract.Template(SinaEditor.CONF.aBubbleTemplete);data.src=decodeURI(href);data.srcstr=subStr(decodeURI(href))}var pos=SinaEditor.util.dom.getXY(node,true);var iframePos=SinaEditor.util.dom.getXY(editor.enty,true);pos[1]-=node.offsetHeight;if(iframePos[1]>pos[1]){pos[1]=iframePos[1]}var bubble=SinaEditor.baseBubble.showBubble(html.evaluate(data),{x:pos[0],y:pos[1]});if(!SinaEditor.CONF.aBubbleModify){bubble.id(mid).style.display='none'}else{bubble.id(mid).onclick=function(){if(!SinaEditor.CONF.aBubbleModify(node)){SinaEditor.baseBubble.hiddenBubble()}return false}}if(!SinaEditor.CONF.aBubbleDelete){bubble.id(did).style.display='none'}else{bubble.id(did).onclick=function(){if(!SinaEditor.CONF.aBubbleDelete(node)){SinaEditor.baseBubble.hiddenBubble()}return false}}}}));function subStr(str){var newStr=[];var len=str.length;if(len>30){newStr.push(str.substring(0,15));newStr.push(str.substring(len-15,len));return newStr.join('...')}else{return str}}}());SinaEditor.plugins.add('link',function(args){var editor=this;var btn=null;if(!args.customerPanel){editor.callPlugin({'name':'linkPanel','args':args})}if(!args.customerBtn){editor.callPlugin({'name':'linkBtn','args':args})}editor.operation.link=function(optObj){var range=optObj.range||SinaEditor.range.getCurrentRanges(editor.entyWin)[0];var link=optObj.link;var str=optObj.str||link;if(!link&&!range){console.log("2a. not passed: no action.");return}editor.operation.save(editor);if(optObj.elm){var elm=optObj.elm;if(optObj.link){elm.href=encodeURI(optObj.link);range.selectNodeContents(elm);SinaEditor.range.applyRanges(editor.entyWin,range)}else{SinaEditor.util.dom.removeTag(elm)}}else{var a=SinaEditor.util.dom.createDom('a',{ownerDocument:editor.entyDoc,properties:{'target':'_blank'}});if(!range||range&&range.collapsed){a.innerHTML=str;a.href=encodeURI(link);if(range){range.insertNode(a)}else{editor.entyBody.appendChild(a)}range.selectNodeContents(a);SinaEditor.range.applyRanges(editor.entyWin,range)}else{editor.entyDoc.execCommand('unlink',false,'');if(link){a.href=encodeURI(link);range=SinaEditor.range.getCurrentRanges(editor.entyWin)[0];try{range.surroundContents(a)}catch(e){var content=range.extractContents();a.appendChild(content);range.insertNode(a)}range.selectNodeContents(a);SinaEditor.range.applyRanges(editor.entyWin,range)}}}editor.operation.save(editor)}});SinaEditor.plugins.add('linkBtn',function(args){var editor=this;var linkPanel=editor.panels.link;var hidden=linkPanel.nodes.hidden;var btnConf={title:'Insert link',normalClass:'ico_link_1',disabledClass:'ico_link_4',clickedClass:'ico_link_3',mouseoverClass:'ico_link_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'common'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.link=btn;return{"events":[{"element":btn.$,"events":{'click':function(){if(editor.btns.link.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}var range=SinaEditor.range.getCurrentRanges(editor.entyWin)[0];var str=range.toString();if(SinaEditor.TOOLCONF.addLinkNow&&SinaEditor.TOOLCONF.addLinkNow.test(str)){editor.operation.link({'link':str,'range':range})}else{if(range.collapsed){hidden.style.display=''}linkPanel.show()}return false}}}]}});SinaEditor.plugins.add('linkPanel',function(args){var editor=this;var linkPanel=SinaEditor.winDialog.create({title:'Insert link',content:SinaEditor.TOOLCONF.linkTemplate,funcClose:function(){_back()}});linkPanel.setMiddle();linkPanel.setFixed(true);var okNode=linkPanel.nodes.ok;var cancelNode=linkPanel.nodes.cancel;var textNode=linkPanel.nodes.text;var hiddNode=linkPanel.nodes.hidden;var linkNode=linkPanel.nodes.link;var _tmpNode;var _back=function(){hiddNode.style.display='none';_tmpNode=null;textNode.value='';linkNode.value='http://'};editor.panels.link=linkPanel;SinaEditor.CONF.aBubbleModify=function(node){linkNode.value=decodeURI(node.href);_tmpNode=node;linkPanel.show()};SinaEditor.CONF.aBubbleDelete=function(node){editor.operation.link({'elm':node})};return{"events":[{"element":okNode,"events":{'click':function(){var range=SinaEditor.range.getCurrentRanges(editor.entyWin)[0];editor.operation.link({'link':linkNode.value,'str':textNode.value,'range':range,'elm':_tmpNode});_back();linkPanel.hidden()}}},{"element":cancelNode,"events":{'click':function(){_back();linkPanel.hidden()}}}]}});SinaEditor.plugins.add('markList',function(args){var editor=this;var btn=null;if(!args.customerBtn){editor.callPlugin({'name':'markListBtn','args':args})}editor.operation.markList=function(){editor.operation.save(editor);editor.entyDoc.execCommand("insertunorderedlist",'','');editor.focus();editor.operation.save(editor)}});SinaEditor.plugins.add('markListBtn',function(args){var editor=this;var btnConf={title:'Unordered List',normalClass:'ico_marklist_1',disabledClass:'ico_marklist_4',clickedClass:'ico_marklist_3',mouseoverClass:'ico_marklist_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'composing'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.markList=btn;return{"events":[{"element":btn.$,"events":{'click':function(){if(btn.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}editor.operation.markList();return false}}}]}});SinaEditor.plugins.add('numberList',function(args){var editor=this;var btn=null;if(!args.customerBtn){editor.callPlugin({'name':'numberListBtn','args':args})}editor.operation.numberList=function(){editor.operation.save(editor);editor.focus();editor.entyDoc.execCommand("insertorderedlist",'','');editor.operation.save(editor)}});SinaEditor.plugins.add('numberListBtn',function(args){var editor=this;var btnConf={title:'Ordered list',normalClass:'ico_numberlist_1',disabledClass:'ico_numberlist_4',clickedClass:'ico_numberlist_3',mouseoverClass:'ico_numberlist_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'composing'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.numberList=btn;return{"events":[{"element":btn.$,"events":{'click':function(){if(btn.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}editor.operation.numberList();return false}}}]}});SinaEditor.plugins.add('outdent',function(args){var editor=this;if(!args.customerBtn){editor.callPlugin({'name':'outdentBtn','args':args})}editor.operation.outdent=function(){editor.focus();editor.operation.save(editor);editor.entyDoc.execCommand("outdent",'','');editor.operation.save(editor);editor.focus()}});SinaEditor.plugins.add('outdentBtn',function(args){var editor=this;var btnConf={title:'Decrease indent',normalClass:'ico_outdent_1',disabledClass:'ico_outdent_4',clickedClass:'ico_outdent_3',mouseoverClass:'ico_outdent_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'composing'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.outdent=btn;return{"events":[{"element":btn.$,"events":{'click':function(){if(btn.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}editor.operation.outdent();return false}}}]}});SinaEditor.plugins.add('pasteFilter',function(args){var editor=this;editor.operation.pasteFilter=function(){var argus=editor.option.filter.args;var i=0;var tags=argus.tagName;if(tags){tags=tags.split('|');var tag,eles;while(tags[i]){eles=editor.entyDoc.getElementsByTagName(tags[i]);while(eles[0]){SinaEditor.util.dom.delElement(eles[0])}i++}}var atts=argus.attribute;if(atts){atts=atts.split('|');walkElment(editor.entyDoc.body,atts)}i=0;var imgs=editor.entyDoc.getElementsByTagName('img');for(;imgs[i];i++){if(imgs[i].src.indexOf('file:///')===0){SinaEditor.util.dom.delElement(imgs[i]);i--}}};var walkElment=function(elmens,atts){if(elmens.nodeType!==SinaEditor.NODETYPE.ELEMENT){return}var i=0;while(atts[i]){elmens.removeAttribute(atts[i]);i++}i=0;if(elmens.hasChildNodes()){var childNodes=elmens.childNodes;while(childNodes[i]){walkElment(childNodes[i],atts);i++}}};var exChangeObject=function(objects){var img,i=0;while(objects[i]){img=SinaEditor.util.dom.createDomFromHTML('<img src="'+SinaEditor.CONF.transparentIMG+'" _se_flash="'+encodeURIComponent(SinaEditor.util.dom.outerHTML(objects[i]))+'" width="'+objects[i].width+'" height="'+objects[i].height+'" style="background:url(\''+SinaEditor.CONF.fakeFLASH+'\') no-repeat scroll center center transparent;border:1px solid #A9A9A9;" >',editor.entyDoc);objects[i].parentNode.replaceChild(img,objects[i])}};var exChangeObjectBack=function(){var imgs=editor.entyDoc.getElementsByTagName('img');var attStr,flash,i=0;while(imgs[i]){attStr=imgs[i].getAttribute('_se_flash');if(attStr){flash=SinaEditor.util.dom.createDomFromHTML(decodeURIComponent(attStr),editor.entyDoc);imgs[i].parentNode.replaceChild(flash,imgs[i])}else{i++}}};return{"events":[{"element":editor.entyBody,"events":{'paste':function(e){setTimeout(function(){var i=0,tds;editor.operation.pasteFilter();exChangeObject(editor.entyDoc.getElementsByTagName('object'));exChangeObject(editor.entyDoc.getElementsByTagName('embed'));tds=editor.entyDoc.getElementsByTagName('td');for(i=0;tds[i];i++){var val=tds[i].textContent||tds[i].textContent;if(!val){tds[i].innerHTML='&nbsp;'}}},10)}}},{"element":editor,"events":{'editorStateChange':function(){var state=this.getState();if(state==SinaEditor.STATE.EDITING){exChangeObject(this.entyDoc.getElementsByTagName('object'));exChangeObject(this.entyDoc.getElementsByTagName('embed'))}else if(state==SinaEditor.STATE.SHOWSOURCE){exChangeObjectBack()}}}}]}});SinaEditor.plugins.add('redoManager',function(args){var editor=this;SinaEditor.redoManager.addEditor(editor);editor._.doManagerBuffer=500;editor.operation.redo=function(e){SinaEditor.redoManager.redo(editor)};editor.operation.undo=function(e){SinaEditor.redoManager.undo(editor)};editor.operation.save=function(e){SinaEditor.redoManager.save(editor)};editor.operation.clearRU=function(e){SinaEditor.redoManager.addEditor(editor)};if(!args.customerBtnU){editor.callPlugin({'name':'undoBtn','args':args})}if(!args.customerBtnR){editor.callPlugin({'name':'redoBtn','args':args})}return{"events":[{"element":editor,"events":{'ctrly':function(e){SinaEditor.redoManager.redo(editor)},'ctrlz':function(e){SinaEditor.redoManager.undo(editor)}}},{"element":editor.entyDoc,"events":{'keydown':function(e){setTimeout(function(){editor.entyWin.clearTimeout(editor._.doManagerBufferTimmer);editor._.doManagerBufferTimmer=editor.entyWin.setTimeout(function(){console.log("Save after "+editor._.doManagerBuffer+" seconds of idle");SinaEditor.redoManager.save(editor)},editor._.doManagerBuffer)},0)}}}]}});SinaEditor.plugins.add('redoBtn',function(args){var editor=this;var btnConf={title:'Redo',normalClass:'ico_redo_1',disabledClass:'ico_redo_4',clickedClass:'ico_redo_3',state:SinaEditor.BUTTONSTATE.DISABLED,group:'redoAndUndo'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.redo=btn;return{"events":[{"element":editor,"events":{'redoAndUndoChanged':function(){if(editor._.hasRedo){btn.setState(SinaEditor.BUTTONSTATE.NORMAL)}else{btn.setState(SinaEditor.BUTTONSTATE.DISABLED)}}}},{'element':btn.$,'events':{'click':function(){if(editor.getState()==SinaEditor.STATE.EDITING){SinaEditor.redoManager.redo(editor)}},'mouseover':function(){if(editor._.hasRedo&&btn.getState()===SinaEditor.BUTTONSTATE.NORMAL){this.className='ico_redo_2'}},'mouseout':function(){this.className='ico_redo_4';if(editor._.hasRedo&&btn.getState()===SinaEditor.BUTTONSTATE.NORMAL){this.className='ico_redo_1'}}}}]}});SinaEditor.plugins.add('showSource',function(args){var editor=this;editor.entyArea=args.entyArea;if(!editor.entyArea){var area=SinaEditor.util.dom.createDom('textarea',{'attributes':{'id':editor.option.id+'_area_'+(+(new Date()))}});area.style.cssText="width:100%;height:100%;display:none;resize:none;";editor.entyArea=area;editor.enty.parentNode.appendChild(area)}if(!editor.customerBtn){editor.callPlugin({'name':'showSourceBtn','args':args})}editor.operation.swapData=function(toArea){var type;var filter=editor.operation.pasteFilter||function(){};if(toArea){editor.setState(SinaEditor.STATE.SHOWSOURCE);filter();editor.entyArea.value=SinaEditor.util.styleHTML(editor.entyBody.innerHTML,1,'\t');editor.entyBody.innerHTML=''}else{editor.entyBody.innerHTML=(editor.entyArea.value).replace(/\u200B|\t|\n|\r/g,'');filter();editor.setState(SinaEditor.STATE.EDITING)}};return{'initialize':function(){editor.entyArea.style.display='none';editor.enty.style.display='';editor.focus();SinaEditor.redoManager.addEditor(editor)}}});SinaEditor.plugins.add('showSourceBtn',function(args){var editor=this;SinaEditor.BUTTON['source']=function(btn){switch(this.getState()){case SinaEditor.STATE.CREATING:btn.setState(SinaEditor.BUTTONSTATE.DISABLED);break;default:btn.setState(SinaEditor.BUTTONSTATE.NORMAL)}};var btnConf={title:'View source',normalClass:'ico_showsrc_1',disabledClass:'ico_showsrc_4',clickedClass:'ico_showsrc_3',mouseoverClass:'ico_showsrc_2',state:SinaEditor.BUTTONSTATE.DISABLED,editorChangeType:'source',group:'common'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.showSource=btn;return{"events":[{"element":btn.$,"events":{'click':function(){var state=editor.getState();if(state===SinaEditor.STATE.EDITING){editor.operation.save(editor);editor.enty.style.display='none';editor.entyArea.style.display='';editor.operation.swapData(true);editor.entyArea.focus()}else if(state===SinaEditor.STATE.SHOWSOURCE){editor.operation.swapData(false);editor.entyArea.style.display='none';editor.enty.style.display='';editor.focus();editor.operation.save(editor)}}}}]}});SinaEditor.plugins.add('submit',function(args){var editor=this;editor.operation.submit=function(){var str='',filter=editor.operation.pasteFilter||function(){};swapData=editor.operation.swapData||function(){};swapData(true);str=editor.entyArea.value;swapData(false);return str}});SinaEditor.plugins.add('tableUI',function(args){var editor=this;if(!args.customerBtn){editor.callPlugin({'name':'tableUIBtn','args':args})}if(!args.customerPanel){editor.callPlugin({'name':'tableUIPanel','args':args})}editor.operation.tableCreate=function(x,y,option){if(x<=0||y<=0){return}editor.operation.save(editor);var tabHTMLs=['<table cellspacing="1" cellpadding="3" style="width:80%;text-align:center;" border="1" >'];var i,j;for(i=0;i<y;i++){tabHTMLs.push('<tr>');for(j=0;j<x;j++){tabHTMLs.push('<td>&nbsp;</td>')}tabHTMLs.push('</tr>')}tabHTMLs.push('</table>');var table=SinaEditor.util.dom.createDomFromHTML(tabHTMLs.join(''),editor.entyDoc);editor.operation.addNode(table);editor.operation.save(editor)}});SinaEditor.plugins.add('tableUIBtn',function(args){var editor=this;var btnConf={title:'Insert table',normalClass:'ico_table_1',disabledClass:'ico_table_4',clickedClass:'ico_table_3',mouseoverClass:'ico_table_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'richdata'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.tableUI=btn;editor.btns.tableUI.PANELX=0;editor.btns.tableUI.PANELY=0;return{"events":[{"element":btn.$,"events":{'click':function(){if(btn.getState()===SinaEditor.BUTTONSTATE.DISABLED){return false}var panel=editor.panels.tableUI;var scroll=SinaEditor.util.dom.getScrollPos();var pos=SinaEditor.util.dom.getXY(btn.$);panel.setPosition({x:pos[0],y:(pos[1]+btn.$.offsetHeight)});panel.nodes.chooseContent.style.width='0em';panel.nodes.chooseContent.style.height='0em';panel.show();var palPos=SinaEditor.util.dom.getXY(panel.nodes.panel);editor.btns.tableUI.PANELX=palPos[0];editor.btns.tableUI.PANELY=palPos[1];return false}}}]}});SinaEditor.plugins.add('tableUIPanel',function(args){var editor=this;var btn=null;var colors=args.colors||SinaEditor.TOOLCONF.COLOR;var tablePanel=new SinaEditor._.Panel();tablePanel.setTemplate(SinaEditor.TOOLCONF.tableTemplate);var panel=tablePanel.nodes.panel;var eventContent=tablePanel.nodes.eventContent;var baseContent=tablePanel.nodes.baseContent;var chooseContent=tablePanel.nodes.chooseContent;var tabNums=tablePanel.nodes.tabNums;editor.panels.tableUI=tablePanel;return{"events":[{"element":eventContent,"events":{'mousemove':function(e){var btn=editor.btns.tableUI;var scroll=SinaEditor.util.dom.getScrollPos();var xLoc=parseInt((e.clientX-btn.PANELX+scroll[1])/16,10)||1;var yLoc=parseInt((e.clientY-btn.PANELY+scroll[0])/16,10)||1;xLoc=xLoc>20?20:xLoc;yLoc=yLoc>20?20:yLoc;chooseContent.style.width=xLoc+'em';chooseContent.style.height=yLoc+'em';var tmpWidth=(xLoc<5?5:xLoc)+'em';baseContent.style.width=tmpWidth;baseContent.style.height=(yLoc<5?5:yLoc)+'em';eventContent.style.width=tmpWidth;tabNums.innerHTML=[xLoc,' * '+yLoc].join('')}}},{"element":document,"events":{'click':function(e){var target=e.target;if(SinaEditor.util.dom.containsNode(editor.btns.tableUI.$,target)){return}if(!SinaEditor.util.dom.containsNode(panel,target)){tablePanel.hidden()}}}},{"element":chooseContent,"events":{'click':function(e){var matrix=tabNums.innerHTML;var arr=matrix.split('*');editor.operation.tableCreate(parseInt(arr[0],10),parseInt(arr[1],10));tablePanel.hidden()}}},{"element":editor,"events":{'editorSelectionChange':function(){tablePanel.hidden()}}}]}});SinaEditor.plugins.add('underline',function(args){var editor=this;if(!args.customerBtn){editor.callPlugin({'name':'underlineBtn','args':args})}var btn=editor.btns.underline;editor.operation.underline=function(refNode){var ranges=SinaEditor.range.getCurrentRanges(editor.entyWin);ranges=ranges[0];if(!ranges){return}editor.operation.save(editor);var isUnderline=editor.operateState.underline;if(isUnderline){console.log('Remove underline');SinaEditor.range.removeStyle(editor,{'useTagName':'span','style':'textDecoration'});btn.setState(SinaEditor.BUTTONSTATE.NORMAL)}else{console.log('Underline');SinaEditor.range.applyStyle(editor,{'useTagName':'span','style':'textDecoration','value':'underline'});btn.setState(SinaEditor.BUTTONSTATE.CLICKED)}editor.operateState.underline=!isUnderline;editor.operation.save(editor)};return{"events":[{"element":editor,"events":{'editorSelectionChange':function(e,range,refNode){var isUnderline=SinaEditor.range.queryCommandState(this.entyDoc,'underline');if(isUnderline){btn.setState(SinaEditor.BUTTONSTATE.CLICKED)}else{btn.setState(SinaEditor.BUTTONSTATE.NORMAL)}this.operateState.underline=isUnderline},'ctrlu':function(){editor.operation.isUnderline(this)}}}]}});SinaEditor.plugins.add('underlineBtn',function(args){var editor=this;var btnConf={title:'Underline',normalClass:'ico_underline_1',disabledClass:'ico_underline_4',clickedClass:'ico_underline_3',mouseoverClass:'ico_underline_2',state:SinaEditor.BUTTONSTATE.DISABLED,group:'common'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.underline=btn;return{"events":[{'element':btn.$,'events':{'click':function(){editor.operation.underline(editor)}}}]}});SinaEditor.plugins.add('undoBtn',function(args){var editor=this;var btnConf={title:'Undo',normalClass:'ico_undo_1',disabledClass:'ico_undo_4',clickedClass:'ico_undo_3',state:SinaEditor.BUTTONSTATE.DISABLED,group:'redoAndUndo'};btnConf=SinaEditor.util.mix(btnConf,args.btnConf);var btn=SinaEditor.ButtonFactory.createButton(btnConf,editor);editor.btns.undo=btn;return{"events":[{"element":editor,"events":{'redoAndUndoChanged':function(){if(editor._.hasUndo){btn.setState(SinaEditor.BUTTONSTATE.NORMAL)}else{btn.setState(SinaEditor.BUTTONSTATE.DISABLED)}}}},{'element':btn.$,'events':{'click':function(){if(editor.getState()==SinaEditor.STATE.EDITING){SinaEditor.redoManager.undo(editor)}},'mouseover':function(){console.log('112233');if(editor._.hasUndo&&btn.getState()===SinaEditor.BUTTONSTATE.NORMAL){this.className='ico_undo_2'}},'mouseout':function(){this.className='ico_undo_4';if(editor._.hasUndo&&btn.getState()===SinaEditor.BUTTONSTATE.NORMAL){this.className='ico_undo_1'}}}}]}});if(!SinaEditor.$abstract){SinaEditor.$abstract={}}SinaEditor.$abstract.baseEditor=function(oOption){this._state=SinaEditor.STATE.CREATING;this.option=oOption||{};this.option.eventBlackList=this.option.eventBlackList||'';this._jobTable=[];this._jobTableIndex={};this.enty=null;this.entyWin=null;this.entyDoc=null;this.entyBody=null;this.entyArea=null;this.hasAddEvent=false;this.btns={};this.panels={};this._={};this.errorMsg=[];this.operation={};this.operateState={}}.$define({error:function(sMsg){console.error(sMsg);this.errorMsg.push(sMsg)},add:function(pluginConf){this._jobTable.push(pluginConf)},start:function(){if(this.option.onStart){this.option.onStart()}this.queue(this._jobTable)},queue:function(jobs,callback){var _this=this;var joblen=jobs.length;var i=0;_this.callPlugin(jobs[i]);var interNum=window.setInterval(function(){i++;if(i>=joblen){clearInterval(interNum);interNum=null;SinaEditor.ev.fire(_this,'editorOnladed');return}if(_this.entyWin){if(!_this.hasAddEvent){_this.hasAddEvent=true;var ev=null;for(ev in SinaEditor.ev.customEvent){if(_this.option.eventBlackList.indexOf(ev)<0){SinaEditor.ev.$regEvent(ev,_this)}else{console.log(_this.option.id+'Blacklisted:'+ev)}}}_this.callPlugin(jobs[i]);_this.setState(SinaEditor.STATE.CREATED);_this.setState(SinaEditor.STATE.EDITING)}else{console.log("Hold on");i--}},10)},callPlugin:function(pluginConf){var getTime=function(){return new Date().valueOf()};var plugnFuc=SinaEditor.plugins.get(pluginConf.name);if(!plugnFuc){console.log(pluginConf);console.log("---------------------------plugin not found:");return}var jobObj=plugnFuc.call(this,pluginConf.args||{})||{};console.log(this.option.id+'Adding job:'+pluginConf.name);var job=jobObj.initialize;var jEvents=jobObj.events;if(typeof jobObj=='undefined'){this.error("<b>Job["+pluginConf.name+"] is undefiend!!!</b>");return}var _try=true;var _start=getTime();try{if(jEvents){var num=0;for(num=0;jEvents[num];num++){var eObj=jEvents[num];var target=eObj.element;var events=eObj.events;var ev=null;if(!target){console.error('!!!!!+'+ev+'+Binding failed...')}for(ev in events){console.log(target+'Bind'+ev);SinaEditor.ev.add(target,ev,events[ev],{'srcEditor':this})}}}if(job){job.call(this)}}catch(e){this.error("<b>Job["+pluginConf.name+"] failed!!!</b>"+e.message+"");_try=false;throw e}finally{if(_try){var _end=getTime()}}},focus:function(){this.entyWin.focus()},setState:function(state){this._state=state;SinaEditor.ev.fire(this,'editorStateChange')},getState:function(){return this._state}});SinaEditor.createEditor=function(conf){var job=new(eval('('+conf.editorName+')'))(conf);var pName=conf.plugns,i;job.add(conf.initType);if(conf.filter){job.add(conf.filter)}for(i=0;pName[i];i++){job.add(pName[i])}job.start();return job};SinaEditor._={};if(!SinaEditor._){SinaEditor._={}}SinaEditor._.entyimpl={};SinaEditor._.entyimpl.normalEditor=function(){}.$extends(SinaEditor.$abstract.baseEditor).$define({});SinaEditor._.IRenderer={setCanShow:function(state){},setCanHidden:function(state){},show:function(node){},hidden:function(node){},addEventListener:function(type,handle){},removeEventListener:function(type,handle){}};SinaEditor._.OpacityRenderer=function(){this.__canShow=true;this.__canHidden=true;this.__node=null;this.__tween=new SinaEditor._.TweenStrategy(0,0,0.6,SinaEditor._.Transition.strongEaseOut);this.__state="";this.__lastState="";this.__value=0;this.__node=null;this.__eventDispatcher=new SinaEditor._.EventDispatcher(this);this.__initTweenEvent()}.$implements(SinaEditor._.IRenderer).$define({setCanShow:function(state){this.__canShow=!!state},setCanHidden:function(state){this.__canHidden=!!state},show:function(node){var tn=this.__tween;tn.stop();SinaEditor.util.dom.setStyle(node,"opacity",this.__value);node.style.display="";this.__node=node;this.__state="show";this.__eventDispatcher.dispatchEvent("beforeShow");if(this.__canShow){tn.startValue=this.__value;tn.endValue=1;tn.start()}return this},hidden:function(node){var tn=this.__tween;tn.stop();this.__node=node;this.__state="hidden";this.__eventDispatcher.dispatchEvent("beforeHidden");if(this.__canHidden){tn.startValue=this.__value;tn.endValue=0;tn.start()}return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},__initTweenEvent:function(){var me=this;this.__tween.addEventListener("tween",function(v){me.__value=v;SinaEditor.util.dom.setStyle(me.__node,"opacity",v)});this.__tween.addEventListener("end",function(){if(me.__node&&me.__node.style.filter){me.__node.style.filter=""}if(me.__state!==""&&me.__state!==me.__lastState){me.__lastState=me.__state;me.__eventDispatcher.dispatchEvent(me.__state)}if(me.__state==="hidden"){me.__node.style.display="none"}})}});SinaEditor._.SimpleRenderer=function(){this.__canShow=true;this.__canHidden=true;this.__eventDispatcher=new SinaEditor._.EventDispatcher(this)}.$implements(SinaEditor._.IRenderer).$define({setCanShow:function(state){this.__canShow=!!state},setCanHidden:function(state){this.__canHidden=!!state},show:function(node){this.__eventDispatcher.dispatchEvent("beforeShow");if(this.__canShow){node.style.display="";this.__eventDispatcher.dispatchEvent("show")}return this},hidden:function(node){this.__eventDispatcher.dispatchEvent("beforeHidden");if(this.__canHidden){node.style.display="none";this.__eventDispatcher.dispatchEvent("hidden")}return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this}});SinaEditor._.Transition={simple:function(t,b,c,d){return c*t/d+b},backEaseIn:function(t,b,c,d){var s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b},backEaseOut:function(t,b,c,d){var s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},backEaseInOut:function(t,b,c,d){var s=1.70158;if((t/=d/2)<1){return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b}return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b},bounceEaseOut:function(t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+0.75)+b}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+0.9375)+b}else{return c*(7.5625*(t-=(2.625/2.75))*t+0.984375)+b}},bounceEaseIn:function(t,b,c,d){return c-Transition.bounceEaseOut(d-t,0,c,d)+b},bounceEaseInOut:function(t,b,c,d){if(t<d/2){return Transition.bounceEaseIn(t*2,0,c,d)*0.5+b}else{return Transition.bounceEaseOut(t*2-d,0,c,d)*0.5+c*0.5+b}},regularEaseIn:function(t,b,c,d){return c*(t/=d)*t+b},regularEaseOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},regularEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return-c/2*((--t)*(t-2)-1)+b},strongEaseIn:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},strongEaseOut:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},strongEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b},elasticEaseIn:function(t,b,c,d){var a,p,s;if(t===0){return b}if((t/=d)==1){return b+c}p=d*0.3;if(!a||a<Math.abs(c)){a=c;s=p/4}else{s=p/(2*Math.PI)*Math.asin(c/a)}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b},elasticEaseOut:function(t,b,c,d){var a,p,s;if(t===0){return b}if((t/=d)==1){return b+c}if(!p){p=d*0.3}if(!a||a<Math.abs(c)){a=c;s=p/4}else{s=p/(2*Math.PI)*Math.asin(c/a)}return(a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b)},elasticEaseInOut:function(t,b,c,d){var a,p,s;if(t===0){return b}if((t/=d/2)==2){return b+c}if(!p){p=d*(0.3*1.5)}if(!a||a<Math.abs(c)){a=c;s=p/4}else{s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return-0.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*0.5+c+b}};SinaEditor._.TweenStrategy=function(startValue,endValue,duration,motion){this.startValue=startValue||0;this.endValue=endValue||0;this.duration=duration||0;this.motion=motion||SinaEditor._.Transition.simple;this.__eventDispatcher=new SinaEditor._.EventDispatcher(this)}.$define({motion:null,duration:0,startValue:0,endValue:0,_itvID:0,_isTweenning:false,addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},start:function(){if(this._isTweenning){return}this._isTweenning=true;var me=this,t,sv=this.startValue,ev=this.endValue,d=this.duration,value,startTime=(new Date()).getTime();this._itvID=window.setInterval(function(){t=((new Date()).getTime()-startTime)/1000;if(t>me.duration){t=me.duration}value=me.motion(t,sv,ev-sv,d);if(me.onTween){me.onTween(value)}me.__eventDispatcher.dispatchEvent("tween",value);if(t===me.duration){me.stop()}},25);return this},stop:function(){window.clearInterval(this._itvID);this._isTweenning=false;if(this.onEnd){this.onEnd()}this.__eventDispatcher.dispatchEvent("end");return this},onTween:function(value){},onEnd:function(){}});SinaEditor._.IDragger={addEventListener:function(type,handle){},removeEventListener:function(type,handle){},setDrag:function(node,attachNodes,isDragCapureNode){},setLock:function(state){},setArea:function(area){},destroy:function(){}};SinaEditor._.BorderDragger=function(){this.__drag=null;this.__isBindEvent=false;this.__border=null;this.__dragNode=null;this.__isCreated=false;this.__tweenX=new SinaEditor._.TweenStrategy(0,0,0.5,SinaEditor._.Transition.strongEaseOut);this.__tweenY=new SinaEditor._.TweenStrategy(0,0,0.5,SinaEditor._.Transition.strongEaseOut);this.__eventDispatcher=new SinaEditor._.EventDispatcher(this)}.$implements(SinaEditor._.IDragger).$define({addEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.addEventListener(type,handle)}else{this.__drag.addEventListener(type,handle)}return this},removeEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.removeEventListener(type,handle)}else{this.__drag.removeEventListener(type,handle)}return this},setDrag:function(node,attachNode,isDragCapureNode){if(!this.__isCreated){this.__createBorder(attachNode);this.__initTweenEvent(attachNode)}this.__drag=new SinaEditor._.Drag(node,this.__border,isDragCapureNode);this.__dragNode=attachNode;this.__initDragEvent();return this},setLock:function(state){this.__drag.isLock=!!state;return this},setArea:function(area){this.__drag.lockArea=area;return this},destroy:function(){this.__drag.destroy()},__createBorder:function(node){this.__border=SinaEditor.util.dom.createDom("div");var st=this.__border.style;st.border="2px dashed #BCC4D0";st.position="absolute";st.display="none";st.backgroundColor="transparent";st.MozUserSelect="none";document.body.appendChild(this.__border);this.__isCreated=true},__initDragEvent:function(){if(this.__isBindEvent){return}var me=this,bst=this.__border.style,nst=this.__dragNode.style,twX=this.__tweenX,twY=this.__tweenY;this.__drag.addEventListener("beforeDrag",function(){bst.zIndex=nst.zIndex+1;bst.position=nst.position;bst.width=me.__dragNode.offsetWidth-4+"px";bst.height=me.__dragNode.offsetHeight-4+"px";bst.left=parseInt(nst.left,10)+"px";bst.top=parseInt(nst.top,10)+"px";bst.display=""});this.__drag.addEventListener("afterDrag",function(){if(SinaEditor.env.$IE6){nst.left=parseInt(bst.left,10)+"px";nst.top=parseInt(bst.top,10)+"px";bst.display="none";me.__eventDispatcher.dispatchEvent("afterDrag")}else{twX.startValue=parseInt(nst.left,10);twX.endValue=parseInt(bst.left,10);twY.startValue=parseInt(nst.top,10);twY.endValue=parseInt(bst.top,10);twX.start();twY.start()}});this.__isBindEvent=true},__initTweenEvent:function(node){var nst=node.style,bst=this.__border.style,me=this;this.__tweenX.addEventListener("tween",function(v){nst.left=v+"px"});this.__tweenY.addEventListener("tween",function(v){nst.top=v+"px"});this.__tweenX.addEventListener("end",function(){bst.display="none";me.__eventDispatcher.dispatchEvent("afterDrag")})}});SinaEditor._.SimpleDragger=function(){this.__drag=null;this.__eventDispatcher=new SinaEditor._.EventDispatcher(this)}.$implements(SinaEditor._.IDragger).$define({addEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.addEventListener(type,handle)}else{this.__drag.addEventListener(type,handle)}return this},removeEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.removeEventListener(type,handle)}else{this.__drag.removeEventListener(type,handle)}return this},setDrag:function(node,attachNode,isDragCapureNode){var me=this;this.__drag=new SinaEditor._.Drag(node,attachNode,isDragCapureNode);this.__drag.addEventListener("afterDrag",function(){me.__eventDispatcher.dispatchEvent("afterDrag")});return this},setLock:function(state){this.__drag.isLock=!!state;return this},setArea:function(area){this.__drag.lockArea=area;return this},destroy:function(){this.__drag.destroy()}});(function(){SinaEditor._.defineGetter=function(obj,p,fn){if(p instanceof Array&&fn instanceof Array){var i=Math.min(p.length,fn.length);while(i--){if(typeof p[i]==="string"&&__checkFunction(fn[i])){obj[p[i]]={valueOf:(function(j){return function(){return __getValue(obj,fn[j])}})(i),toString:this.valueOf}}}}else if(typeof p==="string"&&__checkFunction(fn)){obj[p]={valueOf:function(){return __getValue(obj,fn)},toString:this.valueOf}}};function __checkFunction(fn){return typeof fn!=="string"&&String.prototype.slice.call(fn,0,8)=="function"}function __getValue(obj,fn){var ret=fn.call(obj);return typeof ret==="string"||typeof ret==="number"?ret:null}})();SinaEditor._.DisplayObject=function(parent,node){SinaEditor._.defineGetter(this,["x","y","z","width","height"],[this.__getX,this.__getY,this.__getZ,this.__getWidth,this.__getHeight]);this.__renderer=null;this.__entity=node;this.__isInited=false;this.__parent=parent||document.body;this.__eventDispatcher=new SinaEditor._.EventDispatcher(this);var ed=this.__eventDispatcher;this.__onBeforeShow=function(){ed.dispatchEvent("beforeShow")};this.__onShow=function(){ed.dispatchEvent("show")};this.__onBeforeHidden=function(){ed.dispatchEvent("beforeHidden")};this.__onHidden=function(){ed.dispatchEvent("hidden")};this.__updateRenderer(SinaEditor._.SimpleRenderer)}.$define({setPosition:function(p){if(!this.__isInited){this.__initEntity()}if(typeof p.x!=="undefined"){this.__entity.style.left=p.x+"px"}if(typeof p.y!=="undefined"){this.__entity.style.top=p.y+"px"}if(typeof p.z!=="undefined"){this.__entity.style.zIndex=p.z}return this},setSize:function(p){if(!this.__isInited){this.__initEntity()}if(typeof p.width!=="undefined"){this.__entity.style.width=p.width+"px"}if(typeof p.height!=="undefined"){this.__entity.style.height=p.height+"px"}return this},setRenderer:function(rendererConstructor){if(!this.__isInited){this.__initEntity()}this.__updateRenderer(rendererConstructor);return this},show:function(rendererConstructor){if(!this.__isInited){this.__initEntity()}this.__updateRenderer(rendererConstructor);this.__renderer.show(this.__entity);return this},hidden:function(rendererConstructor){if(!this.__isInited){this.__initEntity()}this.__updateRenderer(rendererConstructor);this.__renderer.hidden(this.__entity);return this},setCanShow:function(state){this.__renderer.setCanShow(state);return this},setCanHidden:function(state){this.__renderer.setCanHidden(state);return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},destroy:function(){if(!this.__entity){return}if(!this.__isInited){this.__initEntity()}if(this.__entity.parentNode){this.__entity.parentNode.removeChild(this.__entity)}this.__entity=null},__initEntity:function(){var st;if(!this.__entity){this.__entity=SinaEditor.util.dom.createDom("div")}st=this.__entity.style;st.position="absolute";st.left=0;st.top=0;st.zIndex=0;if(!this.__entity.parentNode){this.__parent.appendChild(this.__entity)}this.__isInited=true},__updateRenderer:function(rendererConstructor){if(!rendererConstructor){return}var addEvent=function(){this.__renderer.addEventListener("beforeShow",this.__onBeforeShow).addEventListener("show",this.__onShow).addEventListener("beforeHidden",this.__onBeforeHidden).addEventListener("hidden",this.__onHidden)};if(!this.__renderer){this.__renderer=new rendererConstructor();addEvent.call(this)}else if(this.__renderer.constructor!==rendererConstructor){this.__renderer.removeEventListener("beforeShow",this.__onBeforeShow).removeEventListener("show",this.__onShow).removeEventListener("beforeHidden",this.__onBeforeHidden).removeEventListener("hidden",this.__onHidden);this.__renderer=new rendererConstructor();addEvent.call(this)}},__getX:function(){if(!this.__isInited){this.__initEntity()}return parseInt(this.__entity.style.left,10)},__getY:function(){if(!this.__isInited){this.__initEntity()}return parseInt(this.__entity.style.top,10)},__getZ:function(){if(!this.__isInited){this.__initEntity()}return parseInt(this.__entity.style.zIndex,10)},__getWidth:function(){if(!this.__isInited){this.__initEntity()}return this.__getSize(this.__entity,"offsetWidth")},__getHeight:function(){if(!this.__isInited){this.__initEntity()}return this.__getSize(this.__entity,"offsetHeight")},__getSize:function(node,p){var et=node,v,ov=et.style.visibility;if(et.style.display=="none"){et.style.visibility="hidden";et.style.display="";v=et[p];et.style.display="none";et.style.visibility=ov}else{v=et[p]}return v}});SinaEditor._.Drag=function(captureNode,attachNodes,isDragCapureNode){var me=this;this.canDrag=true;this.isLock=false;this.lockArea={left:0,right:0,top:0,bottom:0};this.__captureNode=captureNode;this.__dragNodes=[];this.__deltaX=[];this.__deltaY=[];this.__eventDispatcher=new SinaEditor._.EventDispatcher(this);this.__isDraging=false;this.__canDragX=true;this.__canDragY=true;this.__dragHandle=function(){me.__drag()};this.__mouseDownHandle=function(){me.__isDraging=true;me.__eventDispatcher.dispatchEvent("beforeDrag");me.__setCapture(true)};this.__mouseUpHandle=function(){if(me.__isDraging){me.__eventDispatcher.dispatchEvent("afterDrag")}me.__isDraging=false;me.__setCapture(false)};this.__initNodes(captureNode,attachNodes,isDragCapureNode);this.__initCaputerNode()}.$define({addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},__getEvent:function(){if(window.event){return window.event}var o=arguments.callee.caller;var e;var n=0;while(o!==null&&n<40){e=o.arguments[0];if(e&&(e.constructor==Event||e.constructor==MouseEvent)){return e}n++;o=o.caller}return e},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},destroy:function(){SinaEditor.ev.remove(this.__captureNode,'mousedown',this.__mouseDownHandle);SinaEditor.ev.remove(document,'mouseup',this.__mouseUpHandle);this.__captureNode=null;this.__dragNodes=null},__initNodes:function(captureNode,attachNodes,isDragCapureNode){if(attachNodes){if(attachNodes instanceof Array){this.__dragNodes=attachNodes}else{this.__dragNodes.push(attachNodes)}if((typeof isDragCapureNode==="undefined"||isDragCapureNode)){this.__dragNodes.push(this.__captureNode)}}else{this.__dragNodes.push(this.__captureNode)}var dns=this.__dragNodes,i=dns.length;while(i--){if(!dns[i].style.position){dns[i].style.position="absolute"}if(!dns[i].style.left){dns[i].style.left=0}if(!dns[i].style.top){dns[i].style.top=0}}},__initCaputerNode:function(){var cn=this.__captureNode,me=this;SinaEditor.ev.add(cn,'mousedown',this.__mouseDownHandle);SinaEditor.ev.add(document,'mouseup',this.__mouseUpHandle)},__setCapture:function(isCapture){var cn=this.__captureNode,dns=this.__dragNodes,evt=this.__getEvent(),i=dns.length;while(i--){this.__deltaX[i]=evt.clientX-parseInt(dns[i].style.left,10);this.__deltaY[i]=evt.clientY-parseInt(dns[i].style.top,10)}if(isCapture){if(SinaEditor.env.$IE){cn.setCapture();SinaEditor.ev.add(cn,'mousemove',this.__dragHandle)}else{SinaEditor.ev.add(document,'mousemove',this.__dragHandle)}}else{if(SinaEditor.env.$IE){cn.releaseCapture();SinaEditor.ev.remove(cn,'mousemove',this.__dragHandle)}else{SinaEditor.ev.remove(document,'mousemove',this.__dragHandle)}}},__drag:function(){if(!this.canDrag){return}var dns=this.__dragNodes,evt=this.__getEvent(),i=dns.length,la=this.lockArea,dX=0,dY=0;this.__eventDispatcher.dispatchEvent("drag");while(i--){dX=evt.clientX-this.__deltaX[i];dY=evt.clientY-this.__deltaY[i];if(this.isLock){dX=Math.min(Math.max(dX,la.left),la.right);dY=Math.min(Math.max(dY,la.top),la.bottom)}dns[i].style.left=dX+"px";dns[i].style.top=dY+"px"}}});SinaEditor._.EventDispatcher=function(target){this.__target=target;this.__events={}}.$define({addEventListener:function(type,handle){if(!this.__checkFunction(handle)){return}var evts=this.__events;type=type.toLowerCase();if(!evts[type]){evts[type]=[]}evts[type].push(handle)},removeEventListener:function(type,handle){var evts=this.__events[type];type=type.toLowerCase();if(!this.__checkFunction(handle)||!evts||!evts.length){return}var i=0;for(i=evts.length-1;i>=0;i--){if(evts[i]===handle){evts.splice(i,1)}}},dispatchEvent:function(type){type=type.toLowerCase();var evts=this.__events[type];if(!evts||!evts.length){return}var args=Array.prototype.slice.call(arguments,0);var i=0;args.shift();for(i=0,l=evts.length;i<l;i++){evts[i].apply(this.__target,args)}},__checkFunction:function(func){return typeof func!=="string"&&String.prototype.slice.call(func,0,8)=="function"}});SinaEditor._.IE6FixedController=function(){var me=this;this.node=null;this.iframeNode=null;this.__orgX=0;this.__orgY=0;this.__isBindScroll=false;this.__fixedHandle=function(){if(me.node){me.node.style.left=document.documentElement.scrollLeft+me.__orgX+"px";me.node.style.top=document.documentElement.scrollTop+me.__orgY+"px"}if(me.iframeNode){me.iframeNode.style.left=me.node.style.left;me.iframeNode.style.top=me.node.style.top}}}.$define({setFixed:function(node,state){this.updateOrgPosition();if(state&&!this.__isBindScroll){SinaEditor.ev.add(window,'scroll',this.__fixedHandle);this.__isBindScroll=true}if(!state&&this.__isBindScroll){SinaEditor.ev.remove(window,'scroll',this.__fixedHandle);this.__isBindScroll=false}},setPosition:function(node,fixedState,p){if(typeof p.x!=="undefined"){if(fixedState){node.style.left=p.x+document.documentElement.scrollLeft+"px";this.__orgX=parseInt(this.node.style.left,10)-document.documentElement.scrollLeft}else{node.style.left=p.x+"px"}}if(typeof p.y!=="undefined"){if(fixedState){node.style.top=p.y+document.documentElement.scrollTop+"px";this.__orgY=parseInt(this.node.style.top,10)-document.documentElement.scrollTop}else{node.style.top=p.y+"px"}}if(typeof p.z!=="undefined"){node.style.zIndex=p.z}},getX:function(node,fixedState){if(fixedState){return parseInt(node.style.left,10)-document.documentElement.scrollLeft}else{return parseInt(node.style.left,10)}},getY:function(node,fixedState){if(fixedState){return parseInt(node.style.top,10)-document.documentElement.scrollTop}else{return parseInt(node.style.top,10)}},updateIframe:function(isFixed){this.setFixed(this.iframeNode,isFixed);if(isFixed){this.__fixedHandle()}},updateOrgPosition:function(){if(!this.node){return}this.__orgX=parseInt(this.node.style.left,10)-document.documentElement.scrollLeft;this.__orgY=parseInt(this.node.style.top,10)-document.documentElement.scrollTop},destroy:function(){SinaEditor.ev.remove(window,'scroll',this.__fixedHandle);this.__isBindScroll=false;this.node=null;this.iframeNode=null}});SinaEditor._.Panel=function(parent,node){this.nodes={};this.uniqueID=this.__getUniqueID();this.entity=null;this.__iframe=null;this.__isSetAdamant=false;this.__templateNodesIDs=[];this.__isFixed=false;if(SinaEditor.env.$IE6){this.__ie6FixedController=new SinaEditor._.IE6FixedController()}}.$extends(SinaEditor._.DisplayObject).$define({setTemplate:function(tpl){var nd=SinaEditor.util.dom.createDom('div',{properties:{'innerHTML':new SinaEditor.$abstract.Template(tpl).evaluate(this.__getNodes(tpl,"i"))}});nd.style.display="none";this.__parent.appendChild(nd);this.__updateTemplate(nd);this.nodes=this.__getNodes(tpl);this.entity=this.__entity;this.nodes.panel=this.entity;return this},setFixed:function(state){if(!this.__isInited){this.__initEntity()}var x=parseInt(this.__entity.style.left,10),y=parseInt(this.__entity.style.top,10);if(SinaEditor.env.$IE6){this.__ie6FixedController.setFixed(this.__entity,state);if(this.__isSetAdamant){this.__ie6FixedController.setFixed(this.__iframe,state)}}else{if(state&&!this.__isFixed){this.setPosition({x:x-Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:y-Math.max(document.documentElement.scrollTop,document.body.scrollTop)});this.__entity.style.position="fixed"}if(!state&&this.__isFixed){this.setPosition({x:x+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:y+Math.max(document.documentElement.scrollTop,document.body.scrollTop)});this.__entity.style.position="absolute"}}this.__isFixed=!!state;this.__updateIframe();return this},setAdamant:function(state){this.__isSetAdamant=!!state;if(this.__isSetAdamant&&!this.__iframe){this.__createIframe()}this.__updateIframe();return this},destroy:function(){if(!this.__entity){return}SinaEditor._.Panel.$super.destroy.call(this);if(this.__ie6FixedController){this.__ie6FixedController.destroy()}if(this.__iframe){this.__iframe.parentNode.removeChild(this.__iframe)}},setPosition:function(p){if(!this.__isInited){this.__initEntity()}if(SinaEditor.env.$IE6){this.__ie6FixedController.setPosition(this.__entity,this.__isFixed,p)}else{SinaEditor._.Panel.$super.setPosition.call(this,p)}this.__updateIframe();return this},setSize:function(p){SinaEditor._.Panel.$super.setSize.call(this,p).__updateIframe();return this},show:function(renderer){SinaEditor._.Panel.$super.show.call(this,renderer).__updateIframe();return this},hidden:function(renderer){SinaEditor._.Panel.$super.hidden.call(this,renderer).__updateIframe();return this},__getX:function(){if(!this.__isInited){this.__initEntity()}if(SinaEditor.env.$IE6){return this.__ie6FixedController.getX(this.__entity,this.__isFixed)}else{return parseInt(this.__entity.style.left,10)}},__getY:function(){if(!this.__isInited){this.__initEntity()}if(SinaEditor.env.$IE6){return this.__ie6FixedController.getY(this.__entity,this.__isFixed)}else{return parseInt(this.__entity.style.top,10)}},__createIframe:function(){this.__iframe=SinaEditor.util.dom.createDom("iframe",{attributes:{'frameBorder':'none'}});this.__parent.insertBefore(this.__iframe,this.__entity);SinaEditor.util.dom.setStyle(this.__iframe,"opacity",0);if(this.__ie6FixedController){this.__ie6FixedController.iframeNode=this.__iframe}this.__updateIframe()},__updateIframe:function(){if(this.__iframe){var st=this.__iframe.style;st.backgroundColor="#ffffff";st.left=this.x+"px";st.top=this.y+"px";st.width=this.width+"px";st.height=this.height+"px";st.position=this.__entity.style.position;st.display=this.__entity.style.display;st.zIndex=this.__entity.style.zIndex;if(SinaEditor.env.$IE6){this.__ie6FixedController.updateIframe(this.__isFixed)}}},__updateIE6FCOrgPosition:function(){if(this.__ie6FixedController){this.__ie6FixedController.updateOrgPosition()}},__updateTemplate:function(nd){var l,t,z,p,d,et=this.__entity;if(et){if(et.parentNode){et.parentNode.removeChild(et)}l=et.style.left;t=et.style.top;z=et.style.zIndex;p=et.style.position;d=et.style.display}else{d="none"}et=this.__entity=SinaEditor.util.dom.$E("_"+this.uniqueID+"_panel");if(!et){et=this.__entity=SinaEditor.util.dom.$E("_"+this.uniqueID+"_entity")}if(!et){throw new Error("[Panel Error]there missing identifier #{panel} in panel template")}et.style.left=l||0;et.style.top=t||0;et.style.zIndex=z||0;et.style.position=p||"absolute";et.style.display=d;this.__parent.replaceChild(et,nd);if(this.__ie6FixedController){this.__ie6FixedController.node=this.__entity}},__getNodes:function(template,mode){var m=mode||"o",p=/\{[^\}]+(?=\})/g,i,nodes={},rets,r;this.__templateNodesIDs=template.match(p);rets=this.__templateNodesIDs;if(rets){i=rets.length;while(i--){r=rets[i].replace("{","");switch(m){case"o":nodes[r]=SinaEditor.util.dom.$E("_"+this.uniqueID+"_"+r);break;case"i":nodes[r]="_"+this.uniqueID+"_"+r;break}}}return nodes},__getUniqueID:function(){return parseInt(Math.random()*1000,10).toString()+(new Date()).getTime().toString()},setContent:function(str){if(this.nodes.content){this.nodes.content.innerHTML=str}}});SinaEditor._.Dialog=function(parent,node){var me=this;this.__dragger=null;this.__isBindUpadateAreaEvent=false;this.__isBindUpdateIE6AreaEvent=false;this.__beforeDragHandle=function(){me.__updateDraggerArea();me.__eventDispatcher.dispatchEvent("beforedrag")};this.__dragHandle=function(){if(me.__isSetAdamant){me.__updateIframe()}me.__eventDispatcher.dispatchEvent("drag")};this.__afterDragHandle=function(){if(me.__isFixed&&SinaEditor.env.$IE6){me.__updateIE6FCOrgPosition()}me.__eventDispatcher.dispatchEvent("afterdrag")};this.__updateDraggerAreaHandle=function(){setTimeout(function(){me.__updateDraggerArea()},1)};this.__setMiddleHandle=function(){me.setMiddle()}}.$extends(SinaEditor._.Panel).$define({setTemplate:function(tpl){SinaEditor._.Dialog.$super.setTemplate.call(this,tpl);this.__initTitleBar();this.setDragger(SinaEditor._.SimpleDragger);return this},setContent:function(content){if(!this.nodes.content){return this}this.nodes.content.innerHTML=new SinaEditor.$abstract.Template(content).evaluate(this.__getNodes(content,"i"));this.__addContentNodes(this.__getNodes(content));return this},setFixed:function(state){SinaEditor._.Dialog.$super.setFixed.call(this,state);if(state){SinaEditor.ev.add(window,'resize',this.__setMiddleHandle)}else{SinaEditor.ev.remove(window,'resize',this.__setMiddleHandle)}this.__updateDraggerArea();return this},setMiddle:function(){var areaHeight=this.__getDocumentSize().height-this.height,goldenSection=(Math.sqrt(5)-1)/2,totalSection=1,goldenSectionY=areaHeight*goldenSection/(goldenSection+totalSection),middleX=this.__getDocumentSize().width/2-this.width/2;if(!this.__isFixed){goldenSectionY+=Math.max(document.documentElement.scrollTop,document.body.scrollTop);middleX+=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)}this.setPosition({x:Math.max(middleX,0),y:Math.max(goldenSectionY,0)});return this},setAreaLocked:function(state){if(!this.__dragger){return this}this.__dragger.setLock(state);return this},setSize:function(p){if(!this.__isInited){this.__initEntity()}if(this.nodes.content){if(typeof p.width!=="undefined"){this.nodes.content.style.width=p.width+"px"}if(typeof p.height!=="undefined"){this.nodes.content.style.height=p.height+"px"}}else{if(typeof p.width!=="undefined"){this.__entity.style.width=p.width+"px"}if(typeof p.height!=="undefined"){this.__entity.style.height=p.height+"px"}}return this},setDragger:function(draggerConstructor){if(!this.nodes.titleBar||!draggerConstructor){return this}if(!this.__dragger){this.__dragger=new draggerConstructor()}else if(this.__dragger.constructor===draggerConstructor){return this}this.__updateDragger(draggerConstructor);return this},destroy:function(){if(!this.__entity){return}SinaEditor._.Dialog.$super.destroy.call(this);SinaEditor.ev.remove(window,'resize',this.__updateDraggerAreaHandle);SinaEditor.ev.remove(window,'resize',this.__setMiddleHandle)},__addContentNodes:function(nodes){var nds=this.nodes,k;for(k in nodes){nds[k]=nodes[k]}},__updateDragger:function(draggerConstructor){if(this.__dragger.constructor!==draggerConstructor){this.__dragger.removeEventListener("beforedrag",this.__beforeDragHandle).removeEventListener("drag",this.__dragHandle).removeEventListener("afterdrag",this.__afterDragHandle);this.__dragger.destroy();this.__dragger=new draggerConstructor()}this.__dragger.setDrag(this.nodes.titleBar,this.__entity,false);this.__dragger.addEventListener("beforedrag",this.__beforeDragHandle).addEventListener("drag",this.__dragHandle).addEventListener("afterdrag",this.__afterDragHandle)},__updateDraggerArea:function(){var l,t,r,b;if(this.__isFixed){l=SinaEditor.env.$IE6?document.documentElement.scrollLeft:0;t=SinaEditor.env.$IE6?document.documentElement.scrollTop:0;r=SinaEditor.env.$IE6?document.documentElement.scrollLeft+this.__getDocumentSize().width-this.width:this.__getDocumentSize().width-this.width;b=SinaEditor.env.$IE6?document.documentElement.scrollTop+this.__getDocumentSize().height-this.height:this.__getDocumentSize().height-this.height}else{l=0;t=0;r=document.documentElement.scrollWidth-this.width;b=document.documentElement.scrollHeight-this.height}this.__dragger.setArea({left:l,top:t,right:r,bottom:b})},__initTitleBar:function(){if(!this.nodes.titleBar){return}var tb=this.nodes.titleBar;tb.style.cursor="move";if(SinaEditor.env.$IE){SinaEditor.ev.add(tb,'selectstart',function(){return false})}else{tb.style.MozUserSelect="none"}},__getDocumentSize:function(){var w=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight;return{width:w,height:h}}});SinaEditor._.ModuleDialog=function(tplConfig,iconSet,cfg){this.__bgShadow=null;this.__dialog=null;this.__isInitBgShadow=false;this.__tplConfig=tplConfig;this.__iconSet=iconSet;this.__dialogQueue=[];this.__zIndex=1024;this.__cfg=cfg||{}}.$define({alert:function(text,cfg){cfg=cfg||{};var dlg=this.__createMessageDialog(this.__tplConfig.alert,cfg);if(dlg.nodes.text){dlg.nodes.text.innerHTML=text||""}dlg.show(cfg.renderer||this.__cfg.renderer).addEventListener("hidden",function(){this.destroy()});if(dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"){dlg.nodes.linkOk.focus()}return dlg},confirm:function(text,cfg){cfg=cfg||{};var dlg=this.__createMessageDialog(this.__tplConfig.confirm,cfg),me=this;if(dlg.nodes.text){dlg.nodes.text.innerHTML=text||""}if(dlg.nodes.btnCancel){dlg.nodes.btnCancel.innerHTML=cfg.textCancel||"å–æ¶ˆ";SinaEditor.ev.add(dlg.nodes.btnCancel,'click',function(ev){if(cfg.funcCancel){cfg.funcCancel.call(dlg)}dlg.hidden(cfg.renderer||me.__cfg.renderer);SinaEditor.ev.stopEvent(ev)});if(dlg.nodes.linkCancel){SinaEditor.ev.add(dlg.nodes.linkCancel,'keydown',function(){var e=me.__getEvent();if(e.keyCode=="13"){if(cfg.funcCancel){cfg.funcCancel.call(dlg)}dlg.hidden(cfg.renderer||me.__cfg.renderer)}})}}dlg.show(cfg.renderer||me.__cfg.renderer).addEventListener("hidden",function(){this.destroy()});if(parseInt(cfg.defaultButton,10)===0){if(dlg.nodes.linkCancel&&dlg.nodes.linkCancel.style.display!=="none"){dlg.nodes.linkCancel.focus()}}else{if(dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"){dlg.nodes.linkOk.focus()}}return dlg},create:function(cfg){var me=this;cfg=cfg||{};var dlg=new SinaEditor._.Dialog();dlg.setTemplate(cfg.tpl||this.__tplConfig.customs);if(cfg.content){dlg.setContent(cfg.content)}if(cfg.width&&!isNaN(cfg.width)){dlg.setSize({width:cfg.width})}if(cfg.height&&!isNaN(cfg.height)){dlg.setSize({height:cfg.height})}return this.__initDialog(dlg,cfg)},__createMessageDialog:function(tpl,cfg){var dlg=new SinaEditor._.Dialog(),me=this,i;dlg.setTemplate(tpl);if(cfg.width&&!isNaN(cfg.width)){dlg.setSize({width:cfg.width})}if(cfg.height&&!isNaN(cfg.height)){dlg.setSize({height:cfg.height})}if(dlg.nodes.subText){dlg.nodes.subText.innerHTML=cfg.subText||""}if(dlg.nodes.icon){dlg.nodes.icon.className=this.__iconSet[cfg.icon||"01"]["class"];dlg.nodes.icon.alt=this.__iconSet[cfg.icon||"01"].alt}if(dlg.nodes.btnOk){dlg.nodes.btnOk.innerHTML=cfg.textOk||"OK";SinaEditor.ev.add(dlg.nodes.btnOk,'click',function(ev){dlg.hidden(cfg.renderer||me.__cfg.renderer);if(cfg.funcOk){cfg.funcOk.call(dlg)}SinaEditor.ev.stopEvent(ev)})}if(dlg.nodes.linkOk){SinaEditor.ev.add(dlg.nodes.linkOk,'keydown',function(){var e=me.__getEvent();if(e.keyCode=="13"){dlg.hidden(cfg.renderer||me.__cfg.renderer);if(cfg.funcOk){cfg.funcOk.call(dlg)}}})}dlg.setDragger(cfg.dragger||me.__cfg.dragger).setFixed(true).setAreaLocked(true);return this.__initDialog(dlg,cfg)},__initDialog:function(dlg,cfg){var me=this;if(dlg.nodes.titleName){dlg.nodes.titleName.innerHTML=cfg.title||"Notice"}if(dlg.nodes.btnClose){SinaEditor.ev.add(dlg.nodes.btnClose,'click',function(){var isCanHidden=true;if(cfg.funcBeforeClose){isCanHidden=cfg.funcBeforeClose.call(dlg)!==false}if(cfg.funcClose){cfg.funcClose.call(dlg)}if(isCanHidden){dlg.hidden()}});SinaEditor.ev.add(dlg.nodes.btnClose,'mousedown',function(ev){SinaEditor.ev.stopEvent(ev)})}dlg.setPosition({z:me.__zIndex}).setRenderer(cfg.renderer||this.__cfg.renderer).setDragger(cfg.dragger||this.__cfg.dragger).setMiddle().addEventListener("beforeHidden",function(){me.__updateDialogQueue(this,"remove")}).addEventListener("beforeShow",function(){var that=this;if(!me.__isInitBgShadow){me.__initBGShadow(this,cfg.isAdamant||me.__cfg.isAdamant)}me.__setBGShadowOpacity(cfg.bgShadowOpacity!==0?cfg.bgShadowOpacity||0.4:cfg.bgShadowOpacity);window.setTimeout(function(){me.__bgShadow.show();me.__updateDialogQueue(that,"add")},1)});dlg.setTitle=function(title){if(this.nodes.titleName){this.nodes.titleName.innerHTML=title}};dlg.setHelp=function(url){if(this.nodes.btnHelp){this.nodes.btnHelp.href=url}};dlg.close=function(){this.hidden()};dlg.getNodes=function(){return this.nodes};dlg.getX=function(){return this.x};dlg.getY=function(){return this.y};dlg.getWidth=function(){return this.width};dlg.getHeight=function(){return this.height};return dlg},__initBGShadow:function(dlg,isAdamant){var w=this.__getDocumentSize().width,h=this.__getDocumentSize().height,me=this;this.__bgShadow=new SinaEditor._.Panel();this.__bgShadow.setTemplate('<div id="#{panel}" style="background-color:black"></div>').setSize({width:w,height:h}).setAdamant(isAdamant).setFixed(true).setPosition({x:0,y:0,z:me.__zIndex});SinaEditor.ev.add(window,'resize',function(){me.__bgShadow.setPosition({x:0,y:0}).setSize({width:me.__getDocumentSize().width,height:me.__getDocumentSize().height})});this.__bgShadow.nodes.panel.parentNode.insertBefore(this.__bgShadow.nodes.panel,dlg.nodes.panel);this.__isInitBgShadow=true},__updateDialogQueue:function(dialog,op){var i,dlg;if(op==="add"){this.__dialogQueue.push(dialog)}else if(op==="remove"){i=this.__dialogQueue.length;while(i--){if(this.__dialogQueue[i]===dialog){this.__dialogQueue.splice(i,1)}}}if(this.__dialogQueue.length===0){this.__bgShadow.hidden()}else{dlg=this.__dialogQueue[this.__dialogQueue.length-1];dlg.nodes.panel.parentNode.appendChild(dlg.nodes.panel);this.__bgShadow.nodes.panel.parentNode.insertBefore(this.__bgShadow.nodes.panel,dlg.nodes.panel);if(this.__bgShadow.__iframe){this.__bgShadow.__iframe.parentNode.insertBefore(this.__bgShadow.__iframe,this.__bgShadow.nodes.panel)}if(dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"){dlg.nodes.linkOk.focus()}}},__setBGShadowOpacity:function(v){v=isNaN(v)?0:Math.max(Math.min(v,1),0);SinaEditor.util.dom.setStyle(this.__bgShadow.nodes.panel,"opacity",v)},__getDocumentSize:function(){var w=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight;return{width:w,height:h}},__getEvent:function(){if(window.event){return window.event}var o=arguments.callee.caller;var e;var n=0;while(o!==null&&n<40){e=o.arguments[0];if(e&&(e.constructor==Event||e.constructor==MouseEvent)){return e}n++;o=o.caller}return e}});SinaEditor.winDialog={};(function(){var dialogTemplates={alert:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">','<tr>','<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">Notice title</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="Close">Close</a></cite></div></th>','<th class="tRight"><span></span></th>','</tr>','</thead>','<tfoot>','<tr>','<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>','</tr>','</tfoot>','<tbody>','<tr>','<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns_Mid"><a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"> </cite></a></p>','</div>','</div>','</td>','<td class="tRight"><span></span></td>','</tr>','</tbody>','</table>'].join(""),confirm:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">','<tr>','<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">Notice title</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="Close">Close</a></cite></div></th>','<th class="tRight"><span></span></th>','</tr>','</thead>','<tfoot>','<tr>','<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>','</tr>','</tfoot>','<tbody>','<tr>','<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" src="',SinaEditor.CONF.transparentIMG,'" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns">','<a  id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"></cite></a>','<a style="margin-left:5px;" id="#{linkCancel}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnCancel}"> <span id="#{cancel}"></span> </cite></a></p>','</div>','</div>','</td>','<td class="tRight"><span></span></td>','</tr>','</tbody>','</table>'].join(""),customs:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">','<tr>','<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">Notice title</strong>','<cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="Close">Close</a></cite>','</div>','</th>','<th class="tRight"><span></span></th>','</tr>','</thead>','<tfoot>','<tr>','<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>','</tr>','</tfoot>','<tbody>','<tr>','<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">','</td>','<td class="tRight"><span></span></td>','</tr>','</tbody>','</table>'].join("")};var iconSet={"01":{"class":"SG_icon SG_icon201","alt":"Warning"},"02":{"class":"SG_icon SG_icon202","alt":"Fail"},"03":{"class":"SG_icon SG_icon203","alt":"Success"},"04":{"class":"SG_icon SG_icon204","alt":"Ask"}};SinaEditor.winDialog=new SinaEditor._.ModuleDialog(dialogTemplates,iconSet,{renderer:SinaEditor._.OpacityRenderer,dragger:SinaEditor._.BorderDragger,isAdamant:SinaEditor.env.$IE6})})();